#!/bin/sh -f
#++
#  omsca - OMS Configuration Assistant Script for EM 
#
#--
#
# MODIFIED
#    rmaggarw   03/17/07 - creation


#
# Make sure certain environment variables are set
#
if [ "$ORACLE_HOME" = "" ]
then
    echo "ORACLE_HOME undefined. You need to set ORACLE_HOME to your Oracle software directory\n"
    exit 0
else
    if [ -d $ORACLE_HOME/jdk/bin ]; 
    then
        JAVA_HOME=$ORACLE_HOME/jdk
        export JAVA_HOME
    else
        echo "Java not found. You may need to set ORACLE_HOME to your Oracle software directory\n"
        exit 0
    fi
fi

uname=`uname`
if [ "$uname" = "SunOS" ];
then

# Set up TZ if not already set, this is done as a workaround
# for bug in JDK 1.3.1
  if [ "$TZ" = "" ]
  then
    TMPFILE=/tmp/setTZ.sh.$$
    grep -v "^#" /etc/TIMEZONE | grep TZ > $TMPFILE
    . $TMPFILE
    echo "TZ set to $TZ\n"
    rm $TMPFILE
  fi
  export TZ

fi

PERL5LIB_NATIVE=:$ORACLE_HOME/perl/lib:$ORACLE_HOME/perl/lib/site_perl

if [ "$PERL5LIB" = "" ] ;
then
   PERL5LIB=${PERL5LIB_NATIVE}
else
   PERL5LIB=${PERL5LIB_NATIVE}:${PERL5LIB}
fi

if [ "$LD_LIBRARY_PATH" = "" ] ; then
   LD_LIBRARY_PATH=$ORACLE_HOME/lib:$ORACLE_HOME/perl/lib
else
   LD_LIBRARY_PATH=$ORACLE_HOME/lib:$ORACLE_HOME/perl/lib:$LD_LIBRARY_PATH
fi

if [ "$SHLIB_PATH" = "" ] ; then
   SHLIB_PATH=$ORACLE_HOME/lib32:$ORACLE_HOME/perl/lib
else
   SHLIB_PATH=$ORACLE_HOME/lib32:$ORACLE_HOME/perl/lib:$SHLIB_PATH
fi

if [ "$LIBPATH" = "" ] ; then
   LIBPATH=$ORACLE_HOME/lib32:$ORACLE_HOME/perl/lib
else
   LIBPATH=$ORACLE_HOME/lib32:$ORACLE_HOME/perl/lib:$LIBPATH
fi

# add java lib to LD_LIBRARY_PATH.
if [ "$uname" = "SunOS" ];
then
    LD_LIBRARY_PATH=$JAVA_HOME/jre/lib/sparc/client:$JAVA_HOME/jre/lib/sparc:$LD_LIBRARY_PATH
elif [ "$uname" = "HP-UX" ] && [ "`uname -m`" = "9000/800" ] ; then
    SHLIB_PATH=$JRE_HOME/lib/PA_RISC2.0/client:$JRE_HOME/lib/PA_RISC2.0:$SHLIB_PATH
elif [ "$uname" = "HP-UX" ] && [ "`uname -m`" = "ia64" ] ; then
    SHLIB_PATH=$JRE_HOME/lib/IA64N/client:$JRE_HOME/lib/IA64N:$SHLIB_PATH
elif [ "$uname" = "Linux" ] && [ "`uname -m`" = "i686" ]  ; then
    LD_LIBRARY_PATH=$JRE_HOME/lib/i386/client:$JRE_HOME/lib/i386:$LD_LIBRARY_PATH
elif [ "$uname" = "Linux" ] && [ "`uname -m`" = "ia64" ] ; then
    LD_LIBRARY_PATH=$JRE_HOME/lib/ia64/client:$JRE_HOME/lib/ia64:$LD_LIBRARY_PATH
elif [ "$uname" = "Linux" ] && [ "`uname -m`" = "ppc64" ] ; then
    LD_LIBRARY_PATH=$JRE_HOME/bin/classic:$JRE_HOME/bin:$LD_LIBRARY_PATH
fi

export PERL5LIB
export LD_LIBRARY_PATH
export SHLIB_PATH
export LIBPATH

# Add the var for HP
if [ "$uname" = "HP-UX" ] ; then
   UNIX95=XPG4;
   export UNIX95
fi

# use ulimit to make sure we have enough descriptors
if [ "$EM_DESCRIPTORS" = "" ]
then
   EM_DESCRIPTORS=1024
fi

CURRENT_LIMIT=`ulimit -n`

if [ "$CURRENT_LIMIT" != "unlimited" ]
then
   if [ $CURRENT_LIMIT -lt $EM_DESCRIPTORS ]
   then
      ulimit -n $EM_DESCRIPTORS
   fi
fi

SCRIPT_DIR=`dirname $0`
$ORACLE_HOME/perl/bin/perl -w $SCRIPT_DIR/omsca.pl $@
