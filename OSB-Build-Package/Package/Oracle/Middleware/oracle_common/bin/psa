#!/bin/sh

#
# check for root
#
AWK=/usr/bin/awk
RUID=`/usr/bin/id|$AWK -F\( '{print $2}'|$AWK -F\) '{print $1}'`
if [ ${RUID} = "root" ];then
  echo "You cannot be logged in as root to run $0"
  echo "Log in as a user other than root and restart $0"
  exit 1
fi

umask 0027

#
# Save current directory
#
curr_dir=`pwd -P`

#
# Figure out the directory where this script resides.
#
script_dir=`dirname $0`
if [ $script_dir = "." ];then
  script_dir=$curr_dir
fi

#
# Set the base install directory (Oracle home directory).
# Assume the base install directory is one level up from where this
# script resides.
#
cd $script_dir/..
base_dir=`pwd`

#
# Set the middleware home directory.
# Assume the middleware home directory is one level up from the base directory
#
cd $base_dir/..
MW_HOME=`pwd`

#
# Restore the current directory
#
cd $curr_dir

#
# Set the JRF directory.
#
if (test -d $MW_HOME/oracle_common/modules)
then
  jrf_dir=$MW_HOME/oracle_common
else
  if (test -d $base_dir/modules)
  then
    jrf_dir=$base_dir
  else
    echo "Location of Java Required Files (JRF) not found."
    exit 1
  fi
fi

#
# Execute WebLogic script to define WL_HOME if the script exists
#
if (test -x $MW_HOME/utils/config/10.3/setHomeDirs.sh)
then
  . "$MW_HOME/utils/config/10.3/setHomeDirs.sh"
fi

#
# Look for the JDK in the Oracle home
#
if (test -x $base_dir/jdk/bin/java)
then
  JAVA_HOME=$base_dir/jdk
  export JAVA_HOME
else
  # If WebLogic is installed, then use the same JDK it uses
  # The commEnv.sh script will set JAVA_HOME
  if (test -x $WL_HOME/common/bin/commEnv.sh)
  then
    . "$WL_HOME/common/bin/commEnv.sh"
  else
    # If Websphere is installed, then use the JDK installed with Websphere
    if (test -x $MW_HOME/oracle_common/common/bin/setWasHome.sh)
    then
      . $MW_HOME/oracle_common/common/bin/setWasHome.sh
      if (test -f $WAS_HOME)
      then
        JAVA_HOME=${WAS_HOME}/java
      fi
    fi
  fi
fi

if [ "$JAVA_HOME" = "" ]
then
  echo JAVA_HOME not found. Set the JAVA_HOME environment variable and rerun.
  exit 1
fi

if [ "$PATH" = "" ];
then
    PATH=$base_dir/bin
else
    PATH=$base_dir/bin:${PATH}
fi
export PATH

OSTYPE=`uname -s` 
export OSTYPE 

#export platform specific variables 
case $OSTYPE in 
   HP-UX) # For HP-UX 
     if [ "$SHLIB_PATH" = "" ] 
     then 
       SHLIB_PATH=$base_dir/lib
     else 
       SHLIB_PATH=$base_dir/lib:${SHLIB_PATH} 
     fi 
     export SHLIB_PATH

     JAVAMODE=-d64 # needed for HP-UX
     ;; 

   AIX) # For AIX 
     if [ "$LIBPATH" = "" ] 
     then 
       LIBPATH=$base_dir/lib
     else 
       LIBPATH=$base_dir/lib:${LIBPATH} 
     fi 
     export LIBPATH
     ;;

   SunOS) # For Sun
     ARCH=`uname -p`
     case $ARCH in
       sparc)
         JAVAMODE=-d64 # needed for Sparc
       ;;
        i386) 
          JAVAMODE=-d64 # needed for X64 
       ;; 
     esac
     ;;  
esac 

if [ "$LD_LIBRARY_PATH" = "" ]
then
  LD_LIBRARY_PATH=$base_dir/lib
else
  LD_LIBRARY_PATH=$base_dir/lib:${LD_LIBRARY_PATH}
fi
export LD_LIBRARY_PATH

# Name of the directory that contains the DataDirect JDBC drivers
datadirect=$jrf_dir/modules/datadirect_4.1

# List of JDBC drivers
jdbc=$jrf_dir/modules/oracle.jdbc_11.1.1/ojdbc6dms.jar:$jrf_dir/modules/oracle.jrf_11.1.1/fmwgenerictoken.jar:$datadirect/wlsqlserver.jar:$datadirect/wldb2.jar:$datadirect/wlsybase.jar:$jrf_dir/modules/mysql-connector-java-commercial-5.1.17/mysql-connector-java-commercial-5.1.17-bin.jar:$base_dir/jlib/postgresql-8.4-701.jdbc4.jar

# ODI standalone required
odidir=$base_dir/oracledi.sdk/lib
odimisc=$base_dir/odi_misc
odidep=$odimisc/ojmisc.jar:$odimisc/help-share.jar:$odimisc/ohj.jar:$odimisc/oracle_ice.jar:$odimisc/share.jar:$odimisc/fmwgenerictoken.jar:$odimisc/wlsybase.jar:$odimisc/wldb2.jar:$odimisc/wlsqlserver.jar:$odidir/hsqldb.jar

# List of jars needed by the Upgrade Assistant framework
CLASSPATH=$base_dir/jlib/ua.jar:$base_dir/jlib/mrua.jar:$jdbc:$base_dir/jlib/jewt4.jar:$jrf_dir/jlib/rcucommon.jar:$base_dir/jlib/SchemaVersion.jar:$jrf_dir/modules/oracle.odl_11.1.1/ojdl.jar:$jrf_dir/modules/oracle.dms_11.1.1/dms.jar:$jrf_dir/modules/oracle.bali.share_11.1.1/share.jar:$jrf_dir/modules/oracle.xdk_11.1.0/xmlparserv2.jar:$jrf_dir/modules/oracle.ldap_11.1.1/ojmisc.jar:$jrf_dir/modules/oracle.help_5.0/help-share.jar:$jrf_dir/modules/oracle.help_5.0/ohj.jar:$jrf_dir/modules/oracle.help_5.0/oracle_ice.jar:$odidep

export CLASSPATH

$JAVA_HOME/bin/java ${JAVAMODE} -Xmx256m -classpath ${CLASSPATH} -Dua.home=$base_dir -Dua.wl.home=$WL_HOME -Dice.pilots.html4.ignoreNonGenericFonts=true -Dsun.lang.ClassLoader.allowArraySyntax=true oracle.ias.update.UpgradeDriver "$@"

