CREATE TABLE ADF_EXTENSION_COLUMN_USAGE 
(
  USAGE_ID NUMBER(18) NOT NULL 
, TABLE_USAGE_ID NUMBER(18) 
, COLUMN_ID NUMBER(18) 
, SANDBOX_NAME VARCHAR2(800)
, CONSTRAINT ADF_EXTENSION_COLUMN_USAGE_PK PRIMARY KEY 
  (
    USAGE_ID 
  )
  ENABLE 
);

CREATE TABLE ADF_EXTENSIBLE_TABLE 
(
  TABLE_NAME VARCHAR2(30) NOT NULL 
, APPLICATION_ID VARCHAR2(30) NOT NULL
, CONTEXT_COLUMN_NAME VARCHAR2(30) 
, TABLE_ID NUMBER(18) NOT NULL
, PARENT_ENTITYDEF_FULLNAME VARCHAR2(240)
, CUSTOM_OBJECT_TABLE VARCHAR2(1) DEFAULT 'N'
, PARENT_ID_COLUMN_NAME VARCHAR2(30)
, CONSTRAINT ADF_EXTENSIBLE_TABLE_PK PRIMARY KEY 
  (
    TABLE_ID 
  )
  ENABLE 
);

CREATE TABLE ADF_EXTENSIBLE_TABLE_USAGE 
(
  USAGE_ID NUMBER(18) NOT NULL 
, ENTITYDEF_FULLNAME VARCHAR2(240) 
, CONTEXT_COLUMN_VALUE VARCHAR2(50) 
, TABLE_ID NUMBER(18)
, SANDBOX_NAME VARCHAR2(800)
, AUTO_NUMBER_SEQUENCE_NEXTVAL NUMBER(18)
, CONSTRAINT ADF_EXTENSIBLE_TABLE_USAGE_PK PRIMARY KEY 
  (
    USAGE_ID 
  )
  ENABLE 
);

CREATE TABLE ADF_EXTENSION_COLUMN 
(
  COLUMN_ID NUMBER(18) NOT NULL 
, COLUMN_NAME VARCHAR2(30) NOT NULL 
, LOGICAL_DATATYPE VARCHAR2(30) 
, INDEXED VARCHAR2(1) 
, TABLE_ID NUMBER(18) 
, CONSTRAINT ADF_EXTENSION_COLUMN_PK PRIMARY KEY 
  (
    COLUMN_ID 
  )
  ENABLE 
);

ALTER TABLE ADF_EXTENSIBLE_TABLE
ADD CONSTRAINT ADF_EXTENSIBLE_TABLE_UK1 UNIQUE 
(
   TABLE_NAME 
)
ENABLE;

ALTER TABLE ADF_EXTENSIBLE_TABLE
ADD CONSTRAINT ADF_EXTENSIBLE_TABLE_UK2 UNIQUE 
(
   PARENT_ENTITYDEF_FULLNAME
)
ENABLE;

DROP INDEX ADF_EXT_TABLE_USAGE_SB;

CREATE INDEX ADF_EXT_TABLE_USAGE_SB
ON ADF_EXTENSIBLE_TABLE_USAGE(SANDBOX_NAME);

ALTER TABLE ADF_EXTENSIBLE_TABLE_USAGE
ADD CONSTRAINT ADF_EXT_TABLE_USAGE_UK1 UNIQUE 
(
  ENTITYDEF_FULLNAME
)
ENABLE;

ALTER TABLE ADF_EXTENSION_COLUMN
ADD CONSTRAINT ADF_EXTENSION_COLUMN_UK1 UNIQUE 
(
  TABLE_ID
, COLUMN_NAME 
)
ENABLE;

DROP INDEX ADF_EXT_COL_USAGE_SB;

CREATE INDEX ADF_EXT_COL_USAGE_SB
ON ADF_EXTENSION_COLUMN_USAGE(SANDBOX_NAME);

ALTER TABLE ADF_EXTENSION_COLUMN_USAGE
ADD CONSTRAINT ADF_EXT_COLUMN_USAGE_EX_FK1 FOREIGN KEY
(
  TABLE_USAGE_ID 
)
REFERENCES ADF_EXTENSIBLE_TABLE_USAGE
(
  USAGE_ID 
)
DEFERRABLE INITIALLY DEFERRED
ENABLE;

ALTER TABLE ADF_EXTENSION_COLUMN_USAGE
ADD CONSTRAINT ADF_EXT_COLUMN_USAGE_EX_FK2 FOREIGN KEY
(
  COLUMN_ID 
)
REFERENCES ADF_EXTENSION_COLUMN
(
  COLUMN_ID 
)
DEFERRABLE INITIALLY DEFERRED
ENABLE;

ALTER TABLE ADF_EXTENSIBLE_TABLE_USAGE
ADD CONSTRAINT ADF_EXT_TABLE_USAGE_EX_FK1 FOREIGN KEY
(
  TABLE_ID 
)
REFERENCES ADF_EXTENSIBLE_TABLE
(
  TABLE_ID 
)
DEFERRABLE INITIALLY DEFERRED
ENABLE;

ALTER TABLE ADF_EXTENSION_COLUMN
ADD CONSTRAINT ADF_EXT_COLUMN_EXTENSIB_FK1 FOREIGN KEY
(
  TABLE_ID 
)
REFERENCES ADF_EXTENSIBLE_TABLE
(
  TABLE_ID 
)
DEFERRABLE INITIALLY DEFERRED
ENABLE;
