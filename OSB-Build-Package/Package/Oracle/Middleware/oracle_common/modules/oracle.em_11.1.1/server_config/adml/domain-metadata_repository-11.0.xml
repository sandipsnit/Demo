<?xml version='1.0' encoding='UTF-8' ?>

<!--
   ADML rules for MDS metadata repository metrics.

   MODIFIED    (MM/DD/YY)
   jhsi         06/22/10 - Fxied validation warnings
   jhsi         10/22/09 - Restored for PS2
   jhsi         02/08/08 - Added write response and load metrics
   jhsi         05/30/07 - Added MDS_Repository column
   jhsi         12/19/06 - Creation

-->

<Adml xmlns="http://www.oracle.com/iAS/aggregator"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      TableSpace="metadata_repository">

 <Table Name="mds_partition_rollup_no_rate">

  <ColumnDef Name="name" Type="String" Key="true"/>
  <ColumnDef Name="repository" Type="String" Key="true"/>
  <ColumnDef Name="readDocument.active" Type="Integer"/>
  <ColumnDef Name="readDocument.totalTime" Type="Double"/>
  <ColumnDef Name="readDocument.averageTime" Type="Double"/>
  <ColumnDef Name="readDocument.completed" Type="Integer"/>
  <ColumnDef Name="writeDocument.active" Type="Integer"/>
  <ColumnDef Name="writeDocument.totalTime" Type="Double"/>
  <ColumnDef Name="writeDocument.averageTime" Type="Double"/>
  <ColumnDef Name="writeDocument.completed" Type="Integer"/>

  <Select Name="mds_partition_rollup_no_rate_result">
   <TableFrom Name="MDS_Partition"/>

   <Column Name="name" Type="String">
    <ColumnFrom Name="Name"/>
   </Column>

   <Column Name="repository" Type="String">
    <ColumnFrom Name="MDS_Repository"/>
   </Column>

   <Column Name="readDocument.active" Type="Integer">
    <Aggregation Operator="Sum" Name="readDocument.active"/>
    <Default>0</Default>
   </Column>

   <Column Name="readDocument.completed" Type="Integer">
    <Aggregation Operator="Sum" Name="readDocument.completed"/>
    <Default>0</Default>
   </Column>

   <Column Name="readDocument.totalTime" Type="Double">
    <Expression Operator="Div">
      <Aggregation Operator="Sum" Name="readDocument.time"/>
      <Value>1000</Value>  <!-- milli to second -->
    </Expression>
    <Default>0</Default>
   </Column>

   <Column Name="readDocument.averageTime" Type="Double">
    <Expression Operator="Div">    
      <Expression Operator="Div">
        <Aggregation Operator="Sum" Name="readDocument.time"/>
        <Value>1000</Value>  <!-- milli to second -->
      </Expression>
      <Aggregation Operator="Sum" Name="readDocument.completed"/>      
    </Expression>
    <Default>0</Default>
   </Column>

   <Column Name="writeDocument.active" Type="Integer">
    <Aggregation Operator="Sum" Name="writeDocument.active"/>
    <Default>0</Default>
   </Column>

   <Column Name="writeDocument.completed" Type="Integer">
    <Aggregation Operator="Sum" Name="writeDocument.completed"/>
    <Default>0</Default>
   </Column>

   <Column Name="writeDocument.totalTime" Type="Double">
    <Expression Operator="Div">
      <Aggregation Operator="Sum" Name="writeDocument.time"/>
      <Value>1000</Value>  <!-- milli to second -->
    </Expression>
    <Default>0</Default>
   </Column>

   <Column Name="writeDocument.averageTime" Type="Double">
    <Expression Operator="Div">    
      <Expression Operator="Div">
        <Aggregation Operator="Sum" Name="writeDocument.time"/>
        <Value>1000</Value>  <!-- milli to second -->
      </Expression>
      <Aggregation Operator="Sum" Name="writeDocument.completed"/>      
    </Expression>
    <Default>0</Default>
   </Column>

   <GroupBy Name="repository"/>
   <GroupBy Name="name"/>
   
  </Select>

 </Table> <!-- mds_partition_rollup_no_rate -->

 <Table Name="mds_partition_rollup">

  <ColumnDef Name="name" Type="String" Key="true"/>
  <ColumnDef Name="repository" Type="String" Key="true"/>
  <ColumnDef Name="readDocument.active" Type="Integer"/>
  <ColumnDef Name="readDocument.throughput" Type="Double"/>
  <ColumnDef Name="readDocument.time" Type="Double"/>
  <ColumnDef Name="readDocument.totalTime" Type="Double"/>
  <ColumnDef Name="readDocument.averageTime" Type="Double"/>
  <ColumnDef Name="readDocument.completed" Type="Integer"/>
  <ColumnDef Name="writeDocument.active" Type="Integer"/>
  <ColumnDef Name="writeDocument.throughput" Type="Double"/>
  <ColumnDef Name="writeDocument.time" Type="Double"/>
  <ColumnDef Name="writeDocument.totalTime" Type="Double"/>
  <ColumnDef Name="writeDocument.averageTime" Type="Double"/>
  <ColumnDef Name="writeDocument.completed" Type="Integer"/>
   
  <Select Name="mds_partition_rollup_result">
   <TableFrom Name="metadata_repository:mds_partition_rollup_no_rate"/>
   
   <Column Name="name" Type="String"/>
   <Column Name="repository" Type="String"/>
   <Column Name="readDocument.active" Type="Integer"/>
   <Column Name="readDocument.completed" Type="Integer"/>
   <Column Name="readDocument.totalTime" Type="Double"/>
   <Column Name="readDocument.averageTime" Type="Double"/>

   <Column Name="readDocument.throughput" Type="Double">
    <Rate Interval="300000">
     <ColumnFrom Name="readDocument.completed"/>
     <Default>0</Default>
    </Rate>
   </Column>

   <Column Name="readDocument.time" Type="Double">
    <Rate Interval="300000">
     <ColumnFrom Name="readDocument.totalTime"/>
     <ColumnFrom Name="readDocument.completed"/>
     <Default>0</Default>
    </Rate>
   </Column>

   <Column Name="writeDocument.active"/>
   <Column Name="writeDocument.completed"/>
   <Column Name="writeDocument.totalTime"/>
   <Column Name="writeDocument.averageTime"/>

   <Column Name="writeDocument.throughput" Type="Double">
    <Rate Interval="300000">
     <ColumnFrom Name="writeDocument.completed"/>
     <Default>0</Default>
    </Rate>
   </Column>

   <Column Name="writeDocument.time" Type="Double">
    <Rate Interval="300000">
     <ColumnFrom Name="writeDocument.totalTime"/>
     <ColumnFrom Name="writeDocument.completed"/>
     <Default>0</Default>
    </Rate>
   </Column>

   <!-- GroupBy Name="repository"/>
   <GroupBy Name="name"/ -->

   <Where>
    <And>
     <Or>
      <Condition Type="String" Operator="EQ">
       <ColumnFrom Name="repository"/>
       <Value Name="repositoryName.parameter"/>
      </Condition>
      <Condition Type="String" Operator="EQ">
       <Value Name="repositoryName.parameter"
              xsi:nil="true"/>
       <Null/>
      </Condition>
     </Or>
     <Or>
      <Condition Type="String" Operator="EQ">
       <ColumnFrom Name="name"/>
       <Value Name="name.parameter"/>
      </Condition>
      <Condition Type="String" Operator="EQ">
       <Value Name="name.parameter"
              xsi:nil="true"/>
       <Null/>
      </Condition>
     </Or>
    </And>
   </Where>

  </Select>

 </Table> <!-- mds_partition_rollup -->

 <Table Name="mds_repository_rollup_no_rate">

  <ColumnDef Name="repository" Type="String" Key="true"/>
  <ColumnDef Name="readDocument.active" Type="Integer"/>
  <ColumnDef Name="readDocument.totalTime" Type="Double"/>
  <ColumnDef Name="readDocument.averageTime" Type="Double"/>
  <ColumnDef Name="readDocument.completed" Type="Integer"/>

  <Select Name="mds_repository_rollup_no_rate_result">
   <TableFrom Name="MDS_Partition"/>

   <Column Name="repository" Type="String">
    <ColumnFrom Name="MDS_Repository"/>
   </Column>

   <Column Name="readDocument.active" Type="Integer">
    <Aggregation Operator="Sum" Name="readDocument.active"/>
    <Default>0</Default>
   </Column>

   <Column Name="readDocument.completed" Type="Integer">
    <Aggregation Operator="Sum" Name="readDocument.completed"/>
    <Default>0</Default>
   </Column>

   <Column Name="readDocument.totalTime" Type="Double">
    <Expression Operator="Div">
      <Aggregation Operator="Sum" Name="readDocument.time"/>
      <Value>1000</Value>  <!-- milli to second -->
    </Expression>
    <Default>0</Default>
   </Column>

   <Column Name="readDocument.averageTime" Type="Double">
    <Expression Operator="Div">    
      <Expression Operator="Div">
        <Aggregation Operator="Sum" Name="readDocument.time"/>
        <Value>1000</Value>  <!-- milli to second -->
      </Expression>
      <Aggregation Operator="Sum" Name="readDocument.completed"/>      
    </Expression>
    <Default>0</Default>
   </Column>

   <GroupBy Name="repository"/>
   
  </Select>

 </Table> <!-- mds_repository_rollup_no_rate -->

 <Table Name="mds_repository_rollup">

  <ColumnDef Name="repository" Type="String" Key="true"/>
  <ColumnDef Name="readDocument.active" Type="Integer"/>
  <ColumnDef Name="readDocument.throughput" Type="Double"/>
  <ColumnDef Name="readDocument.time" Type="Double"/>
  <ColumnDef Name="readDocument.totalTime" Type="Double"/>
  <ColumnDef Name="readDocument.averageTime" Type="Double"/>
  <ColumnDef Name="readDocument.completed" Type="Integer"/>
   
  <Select Name="mds_repository_rollup_result">
   <TableFrom Name="metadata_repository:mds_repository_rollup_no_rate"/>
   
   <Column Name="repository" Type="String"/>
   <Column Name="readDocument.active" Type="Integer"/>
   <Column Name="readDocument.completed" Type="Integer"/>
   <Column Name="readDocument.totalTime" Type="Double"/>
   <Column Name="readDocument.averageTime" Type="Double"/>

   <Column Name="readDocument.throughput" Type="Double">
    <Rate Interval="300000">
     <ColumnFrom Name="readDocument.completed"/>
     <Default>0</Default>
    </Rate>
   </Column>

   <Column Name="readDocument.time" Type="Double">
    <Rate Interval="300000">
     <ColumnFrom Name="readDocument.totalTime"/>
     <ColumnFrom Name="readDocument.completed"/>
     <Default>0</Default>
    </Rate>
   </Column>

   <!-- GroupBy Name="repository"/ -->

   <Where>
     <Condition Type="String" Operator="EQ">
      <ColumnFrom Name="repository"/>
      <Value Name="repositoryName.parameter"/>
     </Condition>
   </Where>

  </Select>

 </Table> <!-- mds_repository_rollup -->

</Adml>


