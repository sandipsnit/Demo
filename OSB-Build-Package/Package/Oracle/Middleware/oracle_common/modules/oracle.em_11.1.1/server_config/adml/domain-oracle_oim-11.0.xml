<?xml version="1.0"?>
<!--  $Header: emas/sysman/admin/adml/domain-oracle_oim-11.0.xml /st_emasgc_11.1as/6 2012/06/15 10:09:37 rayleung Exp $ -->
<!-- 
 Copyright (c) 2009, 2012, Oracle and/or its affiliates. All rights reserved. 

   NAME
     server-oracle_oim-11.0.xml - <one-line expansion of the name>

   DESCRIPTION
     <short description of component this file declares/defines>

   NOTES
     <other useful comments, qualifications, etc.>

   MODIFIED   (MM/DD/YY)
   rayleung    06/12/12 - Bug 14101163
   rayleung    10/31/11 - key columns fixes
   rayleung    04/28/10 - Bug 9662631
   rayleung    12/07/09 - Add SPML WS metrics
   rayleung    10/01/09 - Creation

-->
<Adml xmlns="http://www.oracle.com/iAS/aggregator"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      TableSpace="domain_oracle_oim">
    <Table Name="jdbc">
        <ColumnDef Name="Driver" Type="String" Key="true"/>
        <ColumnDef Name="Url" Type="String" Key="true"/>
        <Select Name="jdbc_result" Distinct="true">
            <TableFrom Name="weblogic.j2ee.descriptor.wl.JDBCDriverParamsBean"/>
            <Column Name="Driver" Type="String">
                <ColumnFrom Name="DriverName"/>
                <Default>0</Default>
            </Column>
            <Column Name="Url" Type="String">
                <ColumnFrom Name="Url"/>
                <Default>0</Default>
            </Column>
            <Where>
                <Condition Type="String" Operator="EQ">
                    <ColumnFrom Name="Name"/>
                    <Value>oimOperationsDB</Value>
                </Condition>
            </Where>
        </Select>
    </Table>

    <Table Name="spml_service">
    <ColumnDef Name="WebserviceName" Type="String" Key="true"/>
    <ColumnDef Name="TotalRequests" Type="Integer"/>
    <ColumnDef Name="AvgRequest" Type="Double"/>
    <ColumnDef Name="ServerName" Type="String"/>

    <Select Name="spml_service_delta">
      <TableFrom Name="domain_j2ee_application:deployment_webservice_endpoint_no_rate"/>
      <Column Name="WebserviceName" Type="String">
        <ColumnFrom Name="webserviceName"/>
      </Column>
      <Column Name="InvocationCount" Type="Integer"/>
      <Column Name="InvocationCount.previous" Type="Integer">
        <Previous Interval="600000" Index="0">
          <ColumnFrom Name="InvocationCount"/>
          <Default>0</Default>
        </Previous>
      </Column>
      <Column Name="AvgRequest" Type="Double">
        <Rate Interval="600000">
          <ColumnFrom Name="TotalInvocationTime"/>
          <ColumnFrom Name="InvocationCount"/>
          <Default>0</Default>
        </Rate>
      </Column>
      <Column Name="ServerName" Type="String"/>
      <Where>
        <Condition Type="String" Operator="EQ">
          <ColumnFrom Name="webserviceName"/>
          <Value>SPMLService</Value>
        </Condition>
      </Where>
    </Select>

    <Select Name="spml_service_result">
      <TableFrom Name="spml_service_delta"/>
      <Column Name="WebserviceName" Type="String"/>
      <Column Name="TotalRequests" Type="Integer">
        <If>
          <Condition Operator="GT">
            <ColumnFrom Name="InvocationCount.previous"/>
            <ColumnFrom Name="InvocationCount"/>
          </Condition>
          <Then>
            <ColumnFrom Name="InvocationCount"/>
          </Then>
          <Else>
            <Expression Operator="Minus">
              <ColumnFrom Name="InvocationCount"/>
              <ColumnFrom Name="InvocationCount.previous"/>
            </Expression>
          </Else>
        </If>
      </Column>
      <Column Name="AvgRequest" Type="Double">
        <If>
          <Condition Operator="EQ">
            <ColumnFrom Name="InvocationCount.previous"/>
            <ColumnFrom Name="InvocationCount"/>
          </Condition>
          <Then>
            <Value>0</Value>
          </Then>
          <Else>
            <ColumnFrom Name="AvgRequest"/>
          </Else>
        </If>
      </Column>
      <Column Name="ServerName" Type="String"/>
    </Select>
  </Table>
</Adml>


