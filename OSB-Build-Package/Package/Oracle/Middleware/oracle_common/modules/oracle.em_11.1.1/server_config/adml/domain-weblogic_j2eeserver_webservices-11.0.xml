<?xml version="1.0"?>

<!--  $Header: emas/sysman/admin/adml/domain-weblogic_j2eeserver_webservices-11.0.xml /st_emasgc_11.1as/3 2010/03/17 13:42:58 jazhou Exp $ -->

<!-- 
 Copyright (c) 2009, 2010, Oracle and/or its affiliates. All rights reserved. 

   NAME
     domain-weblogic_j2eeserver_webservices-11.0.xml - <one-line expansion of the name>

   DESCRIPTION
     Define tables for web services metrics in domain.

   NOTES
     <other useful comments, qualifications, etc.>

   MODIFIED   (MM/DD/YY)
   jazhou      03/16/10 - fix bug 9363017
   jazhou      10/06/09 - Creation

-->

<Adml xmlns="http://www.oracle.com/iAS/aggregator"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" TableSpace="weblogic_j2eeserver">
    
<!-- domain_webservices_policy_stats -->
<Table Name="domain_webservices_policy_stats">

        <ColumnDef Name="policyCategory" Type="String"/>
        <ColumnDef Name="policyName" Type="String" Key="true"/>
        <ColumnDef Name="policyVersion" Type="String" Key="true"/>

        <ColumnDef Name="ServerName" Type="String" Key="true"/>
        <ColumnDef Name="process" Type="String" Key="true"/>

        <ColumnDef Name="appName" Type="String" Key="true"/>
        <ColumnDef Name="webserviceName" Type="String" Key="true"/>
        <ColumnDef Name="portName" Type="String" Key="true"/>
        <ColumnDef Name="moduleName" Type="String" Key="true"/>
        <ColumnDef Name="wsType" Type="String" Key="true"/>

        <ColumnDef Name="soaBinding" Type="String" Key="true"/>
        <ColumnDef Name="soaComposite" Type="String" Key="true"/>
        <ColumnDef Name="soaCompositeAssemblyMember" Type="String" Key="true"/>
        <ColumnDef Name="soaCompositeLabel" Type="String" Key="true"/>
        <ColumnDef Name="soaCompositeRevision" Type="String" Key="true"/>
        <ColumnDef Name="soaDomain" Type="String" Key="true"/>

        <ColumnDef Name="authentication_faults" Type="Integer"/>
        <ColumnDef Name="authentication_successes" Type="Integer"/>
        <ColumnDef Name="authorization_faults" Type="Integer"/>
        <ColumnDef Name="authorization_successes" Type="Integer"/>
        <ColumnDef Name="confidentiality_faults" Type="Integer"/>
        <ColumnDef Name="confidentiality_successes" Type="Integer"/>
        <ColumnDef Name="integrity_faults" Type="Integer"/>
        <ColumnDef Name="integrity_successes" Type="Integer"/>
        <ColumnDef Name="total_policy_faults" Type="Integer"/>

        <Select Name="domain_webservices_policy_stats_result_1">
            <TableFrom Name="interceptor_policy_version"/>

            <Column Name="policyCategory" Type="String">
                <ColumnFrom Name="interceptor"/>
            </Column>
            <Column Name="policyName" Type="String">
                <ColumnFrom Name="interceptor_policy"/>
            </Column>
            <Column Name="policyVersion" Type="String">
                <ColumnFrom Name="Name"/>
            </Column>
            <Column Name="ServerName" Type="String">
                <ColumnFrom Name="ServerName" Table="interceptor_policy_version"/>
            </Column>
            <Column Name="process" Type="String">
                <ColumnFrom Name="Process"/>
            </Column>

            <Column Name="appName" Type="String">
                <ColumnFrom Name="wls_ear"/>
            </Column>

            <Column Name="webserviceName" Type="String">
                <ColumnFrom Name="wls_webservice"/>
            </Column>

            <Column Name="portName" Type="String">
                <ColumnFrom Name="wls_webservice_port"/>
            </Column>

            <Column Name="moduleName" Type="String">
                <ColumnFrom Name="wls_composite_module" />
            </Column>

            <Column Name="wsType" Type="String">
                <ColumnFrom Name="wls_webservices"/>
            </Column>

            <Column Name="soaBinding" Type="String">
                <ColumnFrom Name="soainfra_Binding" />
            </Column>

            <Column Name="soaComposite" Type="String">
                <ColumnFrom Name="soainfra_composite" />
            </Column>

            <Column Name="soaCompositeAssemblyMember" Type="String">
                <ColumnFrom Name="soainfra_composite_assembly_member" />
            </Column>

            <Column Name="soaCompositeLabel" Type="String">
                <ColumnFrom Name="soainfra_composite_label" />
            </Column>

            <Column Name="soaCompositeRevision" Type="String">
                <ColumnFrom Name="soainfra_composite_revision" />
            </Column>

            <Column Name="soaDomain" Type="String">
                <ColumnFrom Name="soainfra_domain" />
            </Column>

            <Column Name="authentication_faults" Type="Integer">
                <ColumnFrom Name="AuthenticationFailures.count"/>
                <Default>0</Default>    
            </Column>
            <Column Name="authorization_faults" Type="Integer">
                <ColumnFrom Name="AuthorizationFailures.count"/>
                <Default>0</Default>            
            </Column>
            <Column Name="confidentiality_faults" Type="Integer">
                <ColumnFrom Name="ConfidentialityFailures.count"/>
                <Default>0</Default>
            </Column>
            <Column Name="integrity_faults" Type="Integer">
                <ColumnFrom Name="IntegrityFailures.count"/>
                <Default>0</Default>
            </Column>
            <Column Name="total_policy_faults" Type="Integer">
                <ColumnFrom Name="TotalViolations.count"/>    
            </Column>

            <Column Name="authentication_successes" Type="Integer">
                <ColumnFrom Name="AuthenticationSuccesses.count"/>
                <Default>0</Default>
            </Column>
            <Column Name="authorization_successes" Type="Integer">
                <ColumnFrom Name="AuthorizationSuccesses.count"/>
                <Default>0</Default>
            </Column>
            <Column Name="confidentiality_successes" Type="Integer">
                <ColumnFrom Name="ConfidentialitySuccesses.count"/>
                <Default>0</Default>
            </Column>
            <Column Name="integrity_successes" Type="Integer">
                <ColumnFrom Name="IntegritySuccesses.count"/>
                <Default>0</Default>
            </Column>
        </Select>
</Table><!-- domain_webservices_policy_stats -->

<!-- domain_webservices_policy_stats_rollup -->
<Table Name="domain_webservices_policy_stats_rollup">

        <ColumnDef Name="policyName" Type="String" Key="true"/>
        <ColumnDef Name="policyCategory" Type="String"/>
        <ColumnDef Name="total_policy_faults.rollup" Type="Integer"/>
        <ColumnDef Name="total_policy_successes.rollup" Type="Integer"/>
        <ColumnDef Name="total_policy_faults.rate.rollup" Type="Double"/>

        <Select Name="domain_webservices_policy_stats_rollup_result">
            <TableFrom Name="weblogic_j2eeserver:domain_webservices_policy_stats"/>

            <Column Name="policyName" Type="String"/>
            <Column Name="policyCategory" Type="String"/>

            <Column Name="authentication_faults.rollup" Type="Integer">
                 <Aggregation Operator="Sum" Name="authentication_faults"/>
            </Column>
            <Column Name="authorization_faults.rollup" Type="Integer">
                 <Aggregation Operator="Sum" Name="authorization_faults"/>
            </Column> 
            <Column Name="confidentiality_faults.rollup" Type="Integer">
                 <Aggregation Operator="Sum" Name="confidentiality_faults"/>
            </Column> 
            <Column Name="integrity_faults.rollup" Type="Integer">
                 <Aggregation Operator="Sum" Name="integrity_faults"/>
            </Column> 
            <Column Name="total_policy_faults.rollup" Type="Integer">
                 <Aggregation Operator="Sum" Name="total_policy_faults"/>
            </Column> 

            <Column Name="authentication_successes.rollup" Type="Integer">
                 <Aggregation Operator="Sum" Name="authentication_successes"/>
            </Column> 
            <Column Name="authorization_successes.rollup" Type="Integer">
                 <Aggregation Operator="Sum" Name="authorization_successes"/>
            </Column> 
            <Column Name="confidentiality_successes.rollup" Type="Integer">
                 <Aggregation Operator="Sum" Name="confidentiality_successes"/>
            </Column> 
            <Column Name="integrity_successes.rollup" Type="Integer">
                 <Aggregation Operator="Sum" Name="integrity_successes"/>
            </Column> 
            <GroupBy Name="policyName"/>
            <GroupBy Name="policyCategory"/>
        </Select>

        <Select Name="domain_webservices_policy_stats_rollup_result_1">
            <TableFrom Name="domain_webservices_policy_stats_rollup_result"/>

            <Column Name="policyName" Type="String"/>
            <Column Name="policyCategory" Type="String"/>

            <Column Name="total_policy_faults.rollup" Type="Integer"/>
            <Column Name="total_policy_successes.rollup" Type="Integer">
                 <Expression Operator="Plus">
                      <Expression Operator="Plus">
                          <ColumnFrom Name="authentication_successes.rollup" />
                          <ColumnFrom Name="authorization_successes.rollup" />
                      </Expression>
                      <Expression Operator="Plus">
                          <ColumnFrom Name="confidentiality_successes.rollup" />
                          <ColumnFrom Name="integrity_successes.rollup" />
                      </Expression>
                 </Expression>
                 <Default>0</Default>
            </Column>
            
            <Column Name="total_policy_faults.rate.rollup" Type="Double">
                <Expression Operator="Div">
                    <Expression Operator="Mult">
                       <ColumnFrom Name="total_policy_faults.rollup"/>
                       <Value>100.0</Value>
                    </Expression>
                    <Expression Operator="Plus">
                        <Expression Operator="Plus">
                            <Expression Operator="Plus">
                                <ColumnFrom Name="authentication_successes.rollup" />
                                <ColumnFrom Name="authorization_successes.rollup" />
                            </Expression>
                            <Expression Operator="Plus">
                                <ColumnFrom Name="confidentiality_successes.rollup" />
                                <ColumnFrom Name="integrity_successes.rollup" />
                            </Expression>
                        </Expression>
                        <ColumnFrom Name="total_policy_faults.rollup"/>
                    </Expression>
                </Expression>
                <Default>0.0</Default>
            </Column>    
            <Where>
               <Condition Operator="NE" Type="String">
                  <ColumnFrom Name="policyName"/>
                  <Null/>
               </Condition>
            </Where>        
        </Select>
</Table><!-- domain_webservices_policy_stats_rollup -->


<!-- domain_webservices_policy_stats_delta -->
<Table Name="domain_webservices_policy_stats_delta">
        <ColumnDef Name="policyName" Type="String" Key="true"/>
        <ColumnDef Name="policyCategory" Type="String"/>

        <ColumnDef Name="total_policy_faults.delta" Type="Integer"/>
        <ColumnDef Name="total_policy_successes.delta" Type="Integer"/>
        <ColumnDef Name="total_policy_faults.rate.delta" Type="Double"/>

        <Select Name="domain_webservices_policy_stats_delta_result_1">
             <TableFrom Name="weblogic_j2eeserver:domain_webservices_policy_stats_rollup"/> 

             <Column Name="policyName" Type="String"/>
             <Column Name="policyCategory" Type="String"/>
                 
             <Column Name="total_policy_faults.rollup" Type="Integer"/>
             <Column Name="total_policy_faults.rollup.previous" Type="Integer">
                  <Previous Interval="300000" Index="0">
                      <ColumnFrom Name="total_policy_faults.rollup"/>
                      <Default>0</Default>
                  </Previous>
             </Column>

             <Column Name="total_policy_successes.rollup" Type="Integer"/>
             <Column Name="total_policy_successes.rollup.previous" Type="Integer">
                  <Previous Interval="300000" Index="0">
                      <ColumnFrom Name="total_policy_successes.rollup"/>
                      <Default>0</Default>
                  </Previous>
             </Column>
        </Select>

        <Select Name="domain_webservices_policy_stats_delta_result_2">
             <TableFrom Name="domain_webservices_policy_stats_delta_result_1"/> 

             <Column Name="policyName" Type="String"/>
             <Column Name="policyCategory" Type="String"/>

             <Column Name="total_policy_faults.delta" Type="Integer">
                  <If>
                      <Condition Operator="GT">
                          <ColumnFrom Name="total_policy_faults.rollup.previous"/>
                          <ColumnFrom Name="total_policy_faults.rollup"/>
                      </Condition>
                      <Then>
                          <ColumnFrom Name="total_policy_faults.rollup"/>
                      </Then>
                      <Else>
                          <Expression Operator="Minus">
                              <ColumnFrom Name="total_policy_faults.rollup"/>
                              <ColumnFrom Name="total_policy_faults.rollup.previous"/>
                          </Expression>
                      </Else>
                  </If>
                  <Default>0</Default>
             </Column>

             <Column Name="total_policy_successes.delta" Type="Integer">
                  <If>
                      <Condition Operator="GT">
                          <ColumnFrom Name="total_policy_successes.rollup.previous"/>
                          <ColumnFrom Name="total_policy_successes.rollup"/>
                      </Condition>
                      <Then>
                          <ColumnFrom Name="total_policy_successes.rollup"/>
                      </Then>
                      <Else>
                          <Expression Operator="Minus">
                              <ColumnFrom Name="total_policy_successes.rollup"/>
                              <ColumnFrom Name="total_policy_successes.rollup.previous"/>
                          </Expression>
                      </Else>
                  </If>
                  <Default>0</Default>
             </Column>
        </Select>
        
        <Select Name="domain_webservices_policy_stats_delta_result_3">
             <TableFrom Name="domain_webservices_policy_stats_delta_result_2"/>

             <Column Name="policyName" Type="String"/>
             <Column Name="policyCategory" Type="String"/>

             <Column Name="total_policy_faults.delta" Type="Integer"/>
             <Column Name="total_policy_successes.delta" Type="Integer"/>

             <Column Name="total_policy_faults.rate.delta" Type="Double">
                <Expression Operator="Div">
                    <Expression Operator="Mult">
                       <ColumnFrom Name="total_policy_faults.delta"/>
                       <Value>100.0</Value>
                    </Expression>
                    <Expression Operator="Plus">
                        <ColumnFrom Name="total_policy_successes.delta"/>
                        <ColumnFrom Name="total_policy_faults.delta"/>
                    </Expression>
                </Expression>
                <Default>0.0</Default>
            </Column> 
            <Where>
               <Condition Operator="NE" Type="String">
                  <ColumnFrom Name="policyName"/>
                  <Null/>
               </Condition>
            </Where>
        </Select>
</Table><!-- domain_webservices_policy_stats_delta -->

</Adml>
