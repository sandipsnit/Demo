<?xml version="1.0"?>

<!--  $Header: emas/sysman/admin/adml/server-oracle_oim-11.0.xml /st_emasgc_11.1as/4 2012/04/18 15:22:05 rayleung Exp $ -->

<!-- 
 Copyright (c) 2009, 2012, Oracle and/or its affiliates. All rights reserved. 

   NAME
     server-oracle_oim-11.0.xml - <one-line expansion of the name>

   DESCRIPTION
     <short description of component this file declares/defines>

   NOTES
     <other useful comments, qualifications, etc.>

   MODIFIED   (MM/DD/YY)
   rayleung    10/31/11 - key columns fixes
   rayleung    05/03/10 - Bug 9556884
   rayleung    11/18/09 - Creation

-->
<Adml xmlns="http://www.oracle.com/iAS/aggregator"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      TableSpace="oracle_oim">
      
  <Table Name="event_handler">  
    <ColumnDef Name="ServerName" Type="String" Key="true"/>
    <ColumnDef Name="EventName" Type="String" Key="true"/>
    <ColumnDef Name="CompletedExec" Type="Integer"/>
    <ColumnDef Name="AvgProcess" Type="Double"/>
    <ColumnDef Name="MaxProcess" Type="Double"/>
    <ColumnDef Name="MinProcess" Type="Double"/>
    
    <Select Name="event_handler_delta">
      <TableFrom Name="OIM_EventHandler"/>      
      <Column Name="ServerName" Type="String"/>
      <Column Name="EventName" Type="String">
        <ColumnFrom Name="Name"/>
      </Column>      
      <Column Name="processTime.completed" Type="Integer"/>                    
      <Column Name="processTime.completed.previous" Type="Integer">
        <Previous Interval="600000" Index="0">
          <ColumnFrom Name="processTime.completed"/>
          <Default>0</Default>
        </Previous>
      </Column>
      <Column Name="AvgProcess" Type="Double">
        <Rate Interval="600000">
          <ColumnFrom Name="processTime.time"/>
          <ColumnFrom Name="processTime.completed"/>
          <Default>0</Default>
        </Rate>
      </Column>
      <Column Name="MaxProcess" Type="Double">
        <ColumnFrom Name="processTime.maxTime"/>
        <Default>0</Default>
      </Column>
      <Column Name="MinProcess" Type="Double">
        <ColumnFrom Name="processTime.minTime"/>
        <Default>0</Default>
      </Column>            
    </Select>
    
    <Select Name="event_handler_result">
      <TableFrom Name="event_handler_delta"/>      
      <Column Name="ServerName" Type="String"/>
      <Column Name="EventName" Type="String"/>      
      <Column Name="CompletedExec" Type="Integer">
        <If>
          <Condition Operator="GT">
            <ColumnFrom Name="processTime.completed.previous"/>
            <ColumnFrom Name="processTime.completed"/>
          </Condition>
          <Then>
            <ColumnFrom Name="processTime.completed"/>
          </Then>
          <Else>
            <Expression Operator="Minus">
              <ColumnFrom Name="processTime.completed"/>
              <ColumnFrom Name="processTime.completed.previous"/>
            </Expression>
          </Else>
        </If>
      </Column>
      <Column Name="AvgProcess" Type="Double">
        <If>
          <Condition Operator="EQ">
            <ColumnFrom Name="processTime.completed.previous"/>
            <ColumnFrom Name="processTime.completed"/>
          </Condition>
          <Then>
            <Value>0</Value>
          </Then>
          <Else>
            <ColumnFrom Name="AvgProcess"/>  
          </Else>
        </If>
      </Column>
      <Column Name="MaxProcess" Type="Double"/>
      <Column Name="MinProcess" Type="Double"/>
    </Select>            
  </Table>
  
  <Table Name="adapter">  
    <ColumnDef Name="ServerName" Type="String" Key="true"/>
    <ColumnDef Name="AdapterName" Type="String" Key="true"/>
    <ColumnDef Name="CompletedExec" Type="Integer"/>
    <ColumnDef Name="AvgProcess" Type="Double"/>
    <ColumnDef Name="MaxProcess" Type="Double"/>
    <ColumnDef Name="MinProcess" Type="Double"/>
    
    <Select Name="adapter_delta">
      <TableFrom Name="OIM_Adapter"/>      
      <Column Name="ServerName" Type="String"/>
      <Column Name="AdapterName" Type="String">
        <ColumnFrom Name="Name"/>
      </Column>      
      <Column Name="processTime.completed" Type="Integer"/>                    
      <Column Name="processTime.completed.previous" Type="Integer">
        <Previous Interval="600000" Index="0">
          <ColumnFrom Name="processTime.completed"/>
          <Default>0</Default>
        </Previous>
      </Column> 
      <Column Name="AvgProcess" Type="Double">
        <Rate Interval="600000">
          <ColumnFrom Name="processTime.time"/>
          <ColumnFrom Name="processTime.completed"/>
          <Default>0</Default>
        </Rate>
      </Column>
      <Column Name="MaxProcess" Type="Double">
        <ColumnFrom Name="processTime.maxTime"/>
        <Default>0</Default>
      </Column>
      <Column Name="MinProcess" Type="Double">
        <ColumnFrom Name="processTime.minTime"/>
        <Default>0</Default>
      </Column>       
    </Select>
    
    <Select Name="adapter_result">
      <TableFrom Name="adapter_delta"/>      
      <Column Name="ServerName" Type="String"/>
      <Column Name="AdapterName" Type="String"/>      
      <Column Name="CompletedExec" Type="Integer">
        <If>
          <Condition Operator="GT">
            <ColumnFrom Name="processTime.completed.previous"/>
            <ColumnFrom Name="processTime.completed"/>
          </Condition>
          <Then>
            <ColumnFrom Name="processTime.completed"/>
          </Then>
          <Else>
            <Expression Operator="Minus">
              <ColumnFrom Name="processTime.completed"/>
              <ColumnFrom Name="processTime.completed.previous"/>
            </Expression>
          </Else>
        </If>
      </Column>
      <Column Name="AvgProcess" Type="Double">
        <If>
          <Condition Operator="EQ">
            <ColumnFrom Name="processTime.completed.previous"/>
            <ColumnFrom Name="processTime.completed"/>
          </Condition>
          <Then>
            <Value>0</Value>
          </Then>
          <Else>
            <ColumnFrom Name="AvgProcess"/>  
          </Else>
        </If>
      </Column>
      <Column Name="MaxProcess" Type="Double"/>
      <Column Name="MinProcess" Type="Double"/>     
    </Select>        
  </Table>
  
  <Table Name="jms_queue"> 
    <ColumnDef Name="ServerName" Type="String" Key="true"/>
    <ColumnDef Name="MessageName" Type="String" Key="true"/>
    <ColumnDef Name="CompletedMsg" Type="Integer"/>
    <ColumnDef Name="AvgProcess" Type="Double"/>
    <ColumnDef Name="MaxProcess" Type="Double"/>
    <ColumnDef Name="MinProcess" Type="Double"/>
    
    <Select Name="jms_queue_delta">
      <TableFrom Name="OIM_JMS"/>
      <Column Name="ServerName" Type="String"/> 
      <Column Name="MessageName" Type="String">
        <ColumnFrom Name="Name"/>
      </Column>      
      <Column Name="processTime.completed" Type="Integer"/>                    
      <Column Name="processTime.completed.previous" Type="Integer">
        <Previous Interval="600000" Index="0">
          <ColumnFrom Name="processTime.completed"/>
          <Default>0</Default>
        </Previous>
      </Column> 
      <Column Name="AvgProcess" Type="Double">
        <Rate Interval="600000">
          <ColumnFrom Name="processTime.time"/>
          <ColumnFrom Name="processTime.completed"/>
          <Default>0</Default>
        </Rate>
      </Column>
      <Column Name="MaxProcess" Type="Double">
        <ColumnFrom Name="processTime.maxTime"/>
        <Default>0</Default>
      </Column>
      <Column Name="MinProcess" Type="Double">
        <ColumnFrom Name="processTime.minTime"/>
        <Default>0</Default>
      </Column>            
    </Select>
    
    <Select Name="jms_queue_result">
      <TableFrom Name="jms_queue_delta"/>
      <Column Name="ServerName" Type="String"/>
      <Column Name="MessageName" Type="String"/>      
      <Column Name="CompletedMsg" Type="Integer">
        <If>
          <Condition Operator="GT">
            <ColumnFrom Name="processTime.completed.previous"/>
            <ColumnFrom Name="processTime.completed"/>
          </Condition>
          <Then>
            <ColumnFrom Name="processTime.completed"/>
          </Then>
          <Else>
            <Expression Operator="Minus">
              <ColumnFrom Name="processTime.completed"/>
              <ColumnFrom Name="processTime.completed.previous"/>
            </Expression>
          </Else>
        </If>
      </Column>
      <Column Name="AvgProcess" Type="Double">
        <If>
          <Condition Operator="EQ">
            <ColumnFrom Name="processTime.completed.previous"/>
            <ColumnFrom Name="processTime.completed"/>
          </Condition>
          <Then>
            <Value>0</Value>
          </Then>
          <Else>
            <ColumnFrom Name="AvgProcess"/>  
          </Else>
        </If>
      </Column>
      <Column Name="MaxProcess" Type="Double"/>
      <Column Name="MinProcess" Type="Double"/>    
    </Select>        
  </Table> 
  
  <Table Name="overall">
    <ColumnDef Name="ServerName" Type="String" Key="true"/>
    <ColumnDef Name="CompletedAdapterExec" Type="Integer"/>  
    <ColumnDef Name="CompletedEventExec" Type="Integer"/>
    <ColumnDef Name="CompletedJMSMsg" Type="Integer"/>    
    
    <Select Name="adapter_rollup_result">
      <TableFrom Name="oracle_oim:adapter"/>          
      <Column Name="ServerName" Type="String"/>
      <Column Name="CompletedAdapterExec" Type="Integer">       
        <Aggregation Operator="Sum" Name="CompletedExec"/>
        <Default>0</Default>
      </Column>     
      <GroupBy Name="ServerName"/>
    </Select>
    
    <Select Name="event_handler_rollup_result">
      <TableFrom Name="oracle_oim:event_handler"/>
      <Column Name="ServerName" Type="String"/>
      <Column Name="CompletedEventExec" Type="Integer">       
        <Aggregation Operator="Sum" Name="CompletedExec"/>
        <Default>0</Default>
      </Column>     
      <GroupBy Name="ServerName"/>
    </Select>    
    
    <Select Name="jms_queue_rollup_result">
      <TableFrom Name="oracle_oim:jms_queue"/>
      <Column Name="ServerName" Type="String"/>      
      <Column Name="CompletedJMSMsg" Type="Integer">
        <Aggregation Operator="Sum" Name="CompletedMsg"/>
        <Default>0</Default>
      </Column>     
      <GroupBy Name="ServerName"/>
    </Select>      
    
    <Select Name="overall_temp">
      <TableFrom Name="adapter_rollup_result"/>    
      <TableFrom Name="event_handler_rollup_result"/>    
      <Column Name="ServerName" Type="String">
        <ColumnFrom Name="ServerName" Table="adapter_rollup_result"/>
      </Column>
      <Column Name="CompletedAdapterExec" Type="Integer">
        <ColumnFrom Name="CompletedAdapterExec" Table="adapter_rollup_result"/>
      </Column>
      <Column Name="CompletedEventExec" Type="Integer">
        <ColumnFrom Name="CompletedEventExec" Table="event_handler_rollup_result"/>
      </Column>
    </Select>
    
    <Select Name="overall_result">    
      <TableFrom Name="overall_temp"/>    
      <TableFrom Name="jms_queue_rollup_result"/>               
      <Column Name="ServerName" Type="String">
        <ColumnFrom Name="ServerName" Table="overall_temp"/>
      </Column> 
      <Column Name="CompletedAdapterExec" Type="Integer">
        <ColumnFrom Name="CompletedAdapterExec" Table="overall_temp"/>        
      </Column>
      <Column Name="CompletedEventExec" Type="Integer">
        <ColumnFrom Name="CompletedEventExec" Table="overall_temp"/>        
      </Column>
      <Column Name="CompletedJMSMsg" Type="Integer">   
        <ColumnFrom Name="CompletedJMSMsg" Table="jms_queue_rollup_result"/>
      </Column>
    </Select>
  </Table>            
  
  <Table Name="spml_service">  
    <ColumnDef Name="WebserviceName" Type="String" Key="true"/>    
    <ColumnDef Name="TotalRequests" Type="Integer"/>
    <ColumnDef Name="AvgRequest" Type="Double"/>
    <ColumnDef Name="ServerName" Type="String"/>
    
    <Select Name="spml_service_delta">
      <TableFrom Name="weblogic_j2eeserver:webservice_all_endpoint_no_rate"/>      
      <Column Name="WebserviceName" Type="String">
        <ColumnFrom Name="webserviceName"/>
      </Column>
      <Column Name="InvocationCount" Type="Integer"/>                    
      <Column Name="InvocationCount.previous" Type="Integer">
        <Previous Interval="600000" Index="0">
          <ColumnFrom Name="InvocationCount"/>
          <Default>0</Default>
        </Previous>
      </Column> 
      <Column Name="AvgRequest" Type="Double">
        <Rate Interval="600000">
          <ColumnFrom Name="TotalInvocationTime"/>
          <ColumnFrom Name="InvocationCount"/>
          <Default>0</Default>
        </Rate>
      </Column>
      <Column Name="ServerName" Type="String"/>      
      <Where>
        <Condition Type="String" Operator="EQ">
          <ColumnFrom Name="webserviceName"/>
          <Value>SPMLService</Value>
        </Condition>
      </Where>      
    </Select>
    
    <Select Name="spml_service_result">
      <TableFrom Name="spml_service_delta"/>      
      <Column Name="WebserviceName" Type="String"/>
      <Column Name="TotalRequests" Type="Integer">
        <If>
          <Condition Operator="GT">
            <ColumnFrom Name="InvocationCount.previous"/>
            <ColumnFrom Name="InvocationCount"/>
          </Condition>
          <Then>
            <ColumnFrom Name="InvocationCount"/>
          </Then>
          <Else>
            <Expression Operator="Minus">
              <ColumnFrom Name="InvocationCount"/>
              <ColumnFrom Name="InvocationCount.previous"/>
            </Expression>
          </Else>
        </If>
      </Column>
      <Column Name="AvgRequest" Type="Double">
        <If>
          <Condition Operator="EQ">
            <ColumnFrom Name="InvocationCount.previous"/>
            <ColumnFrom Name="InvocationCount"/>
          </Condition>
          <Then>
            <Value>0</Value>
          </Then>
          <Else>
            <ColumnFrom Name="AvgRequest"/>  
          </Else>
        </If>
      </Column>
      <Column Name="ServerName" Type="String"/>          
    </Select>        
  </Table>
  
</Adml>

