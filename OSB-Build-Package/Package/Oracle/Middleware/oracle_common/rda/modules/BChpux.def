# BChpux.def: HPUX Specific Code for Background Collection (Sampling)
# $Id: BChpux.def,v 2.5 2012/01/03 13:34:41 mschenke Exp $
# ARCS: $Header: /home/cvs/cvs/RDA_4/src/scripting/lib/modules/BChpux.def,v 2.5 2012/01/03 13:34:41 mschenke Exp $
#
# Change History
# 20120103  MSC  Change the copyright notice.

=head1 NAME

BChpux - Submodule for HP-UX-Specific Background Collections

=head1 DESCRIPTION

This module contains the operating system-specific code for the sampling
modules.

=cut

# Make the module persistent
keep $KEEP_BLOCK

# Get the calling module
var ($MODULE,$FACTOR) = @arg
import $TOC,$TOP

#------------------------------------------------------------------------------

=head1 CONTRIBUTION TO THE NPRF MODULE

Collected information:

=over 4

=item o C<iostat 1 1>

=item o C<lsof -S 2>

=item o C<sar -A -S 1 1> (as an alternative to F<mpstat>)

=item o C<netstat -s>

=item o C<ps -elf>

=item o C<top -s 1 -d 1 -n 40>

=item o C<uptime>

=item o C<vmstat 1 1>

=item o The last F<sar> raw data file if C<NPRF_SAR_DATA> setting value is true

=back

=cut

if compare('eq',$MODULE,'NPRF')
{# Collect the performance information
 thread
 {import $FACTOR
  report iostat
  call writeCommand('iostat 1 1',true,$FACTOR)
 }

 thread
 {import $FACTOR
  report lsof
  call writeCommand('lsof -S 2',true,$FACTOR)
 }

 thread
 {import $FACTOR
  report mpstat
  call writeCommand('sar -A -S 1 1',true,$FACTOR)
 }

 thread
 {import $FACTOR
  report netstat
  call writeCommand('netstat -s',true,$FACTOR)
 }

 thread
 {import $FACTOR
  report ps
  call writeCommand('ps -elf',true,$FACTOR)
 }

 thread
 {import $FACTOR
  report top
  var $fil = getTemp('top')
  if loadCommand(concat('top -s 1 -d 1 -n 40 -f ',$fil),true,$FACTOR)
   call writeFile($fil)
  call unlinkTemp('top')
 }

 thread
 {import $FACTOR
  report uptime
  call writeCommand('uptime',true,$FACTOR)
 }

 thread
 {import $FACTOR
  report vmstat
  call writeCommand('vmstat 1 1',true,$FACTOR)
 }

 # Get the last sar raw data file
 if and(getSetting('NPRF_SAR_DATA'),not(isFiltered()))
 {var ($fil) = grepDir('/var/adm/sa','^sa\d+$','pt')
  if $fil
  {data basename($fil)
   call writeData($fil)
  }
 }

 # Specify the trace route command
 var \$CMD = $arg[2]
 var $CMD = 'traceroute -r -F %s 2>&1'
}

#------------------------------------------------------------------------------

=head1 CONTRIBUTION TO THE RPRF MODULE

TBD

=cut

elsif compare('eq',$MODULE,'RPRF')
{
}

#------------------------------------------------------------------------------

=begin credits

=over 14

=item OSwatcher:    Carl Davis.

=item shtriage:     Greg Marsden.

=back

=end credits

=head1 COPYRIGHT NOTICE

Copyright (c) 2002, 2012, Oracle and/or its affiliates. All rights reserved.

=head1 TRADEMARK NOTICE

Oracle and Java are registered trademarks of Oracle and/or its
affiliates. Other names may be trademarks of their respective owners.

=cut
