# EXLcfg.def: Assists Oracle Exalogic Collection Setup
# $Id: EXLcfg.def,v 1.1 2012/05/22 06:55:09 mschenke Exp $
# ARCS: $Header: /home/cvs/cvs/RDA_4/src/scripting/lib/modules/EXLcfg.def,v 1.1 2012/05/22 06:55:09 mschenke Exp $
#
# Change History
# 20120521  KRA  Initial version.

=head1 NAME

EXLcfg - Assists Oracle Exalogic Collection Setup

=head1 DESCRIPTION

This module provides associated logic for the setup of the Oracle Exalogic
collections.

=cut

#------------------------------------------------------------------------------
# Section init: Module initialization
#------------------------------------------------------------------------------
section init

#------------------------------------------------------------------------------
# Section chk_nodes: Check which nodes are present
#------------------------------------------------------------------------------
section chk_nodes

# Determine the associate setup prefix
var ($pre,%nod) = (${AUX.PREFIX})

# Detect the nodes
if loadCommand('/usr/sbin/ibnodes')
{loop $lin (grepLastFile('\".*?\sEL-C\s.*?\"'))
 {if match($lin,'\"(.*?)\sEL-C\s.*?\"')
  {var ($nod) = last
   next match($nod,'^\s*$')
   var $nod{join(".",$nod,${RDA.DOMAIN})} = 1
  }
 }
}

# Customize the setup
if @nod = keys(%nod)
{ var ($cnt,$flg,@all,@dft,@itm,%sel,%rsp) = (0,true)
 var ${AUX.dft} = 1

 # Analyze the previous requests
 if ?getSetting(concat($pre,'_NODES'))
 {loop $nod (split('\|',last))
   var $sel{lc($nod)} = 1
  var $flg = false
 }

 # Generate temporary settings
 loop $nod (@nod)
 {next compare('eq',$nod,${RDA.HOST})
  call push(@itm,incr($cnt),$nod)
  if or($flg,exists($sel{lc($nod)}))
   call push(@dft,$nod)
 }
 call setTempSetting('TMP_DFT_NODES',join('|',@dft))
 call setTempSetting('TMP_ITM_NODES',join('|',@itm))
}

=head1 COPYRIGHT NOTICE

Copyright (c) 2002, 2012, Oracle and/or its affiliates. All rights reserved.

=head1 TRADEMARK NOTICE

Oracle and Java are registered trademarks of Oracle and/or its
affiliates. Other names may be trademarks of their respective owners.

=cut
