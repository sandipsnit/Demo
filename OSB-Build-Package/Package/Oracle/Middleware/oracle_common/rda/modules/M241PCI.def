# M241PCI.def: Collects Peripheral Component Interconnect Information
# $Id: M241PCI.def,v 1.2 2012/03/30 17:25:23 mschenke Exp $
# ARCS: $Header: /home/cvs/cvs/RDA_4/src/scripting/lib/modules/M241PCI.def,v 1.2 2012/03/30 17:25:23 mschenke Exp $
#
# Change History
# 20120230  PRO  Initial version.

=head1 NAME

M241PCI - Performs Peripheral Component Interconnect (PCI) Collection

=head1 DESCRIPTION

Collects Peripheral Component Interconnect information on Solaris x86 systems.

=cut

use Mrc

# Initialization
var $VALIDATE = true
keep $VALIDATE

section begin

var $ERR = '---## Associated Errors'
var $TOP = '[[#Top][Back to top]]'

run XPLRlib('pci')

# -----------------------------------------------------------------------------
# XPLR_pci section
# -----------------------------------------------------------------------------

section XPLR_pci

# Validate the context
if !${XPLR_GLOBAL:true}
 return
if !compare('eq',get_arc(),'i386')
 return
call log_run('Processing PCI sections ...')

=head2 pci - Peripheral Component Interconnect Drivers Information

Gathers the Peripheral Component Interconnect information using the
F</usr/bin/scanpci> or F</usr/X11/bin/scanpci> command with the following
option:

=over 2

=item o C<-v> for Solaris 11

=item o C<-vO> for Solaris 10 and earlier

=back

=cut

# Determine the command
if testFile('fx','/usr/bin/scanpci')
 var $cmd = "/usr/bin/scanpci"
elsif testFile('fx','/usr/X11/bin/scanpci')
 var $cmd = "/usr/X11/bin/scanpci"
else
 return log_info('scanpci not found')
var $cmd = concat($cmd,cond(expr('<',get_osv(),11),' -vO',' -v'))

# Collect the information
debug ' Inside PCI collection, gathering the PCI information'
report pci
prefix
{write '---+!! Peripheral Component Interconnect Devices Information'
 write '---## Using: ',encode($cmd)
}
call collectCommand({nam=>concat('sysconfig/scanpci-',field('-',1,$cmd)),\
  out=>{blk=>true,flt=>true,idx=>true,rpt=>${CUR.REPORT}},\
  err=>{blk=>true,flt=>true,hdr=>$ERR,rpt=>${CUR.REPORT}}\
  },$cmd)
if isCreated(true)
{write $TOP
 toc '2:[[',getFile(),'][rda_report][Peripheral Component Interconnect]]'
}

=head1 SEE ALSO

L<S150XPLR.def|modules::S150XPLR>,
L<XPLRlib.def|modules::XPLRlib>

=head1 COPYRIGHT NOTICE

Copyright (c) 2002, 2012, Oracle and/or its affiliates. All rights reserved.

=head1 TRADEMARK NOTICE

Oracle and Java are registered trademarks of Oracle and/or its
affiliates. Other names may be trademarks of their respective owners.

=cut
