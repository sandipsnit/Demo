# M259STO3.def: Collects StorTools 3.x Information
# $Id: M259STO3.def,v 1.5 2012/05/08 04:36:04 mschenke Exp $
# ARCS: $Header: /home/cvs/cvs/RDA_4/src/scripting/lib/modules/M259STO3.def,v 1.5 2012/05/08 04:36:04 mschenke Exp $
#
# Change History
# 20120507  MSC  Apply naming conventions.

=head1 NAME

M259STO3 - Collects StorTools 3.x Information

=head1 DESCRIPTION

Collects StorTools 3.x information.

=cut

use Mrc

# Initialization
var $VALIDATE = true
keep $VALIDATE

section begin

var $TOP = '[[#Top][Back to top]]'

run XPLRlib('stortools')

# -----------------------------------------------------------------------------
# XPLR_stortools section
# -----------------------------------------------------------------------------

section XPLR_stortools

# Validate the execution context
if !${XPLR_GLOBAL:true}
 return
call log_run('Processing STO3 sections ...')
if !is_pkg_installed('STORtools')
 return log_info('STORtools package is not installed')

=head2 sto3 - StorTools 3.x Information

Collects the Golden Snapshot files present in the F</var/opt/STORtools/logs>
directory.

=cut

debug ' Inside STORTOOLS collection, collecting global files'
report sto3
prefix
{write '---+!! Golden Snapshot Files'
 write '   * Links point to files that have been collected in their original \
             format. Opening them directly in your browser can present risks. \
             To prevent them, access the file outside the browser or use the \
             link to save them and use an adequate viewer.'
 write '|*File Path*| *Size*|*Last Modified Date*|'
}
loop $fil (grepDir('/var/opt/STORtools/logs','^Golden_Snapshot','np'))
{if testFile('f',$fil)
 {var $nam = concat('disks/stortools/',basename($fil))
  if collectFile($nam,$fil)
   write '|[[',last,'][_blank][',$fil,']] | ',getSize($fil),'|',\
         getLastModify($fil,'%d-%b-%Y&nbsp;%H:%M:%S'),' |'
 }
}
if isCreated(true)
{write $TOP
 toc '2:[[',getFile(),'][rda_report][StorTools 3.x Information]]'
}

=head1 SEE ALSO

L<S150XPLR.def|modules::S150XPLR>,
L<XPLRlib.def|modules::XPLRlib>

=head1 COPYRIGHT NOTICE

Copyright (c) 2002, 2012, Oracle and/or its affiliates. All rights reserved.

=head1 TRADEMARK NOTICE

Oracle and Java are registered trademarks of Oracle and/or its
affiliates. Other names may be trademarks of their respective owners.

=cut
