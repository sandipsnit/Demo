# OIDr11.def: Defines Common Macros for Oracle Internet Directory 11g
# $Id: OIDr11.def,v 2.9 2012/01/03 13:34:42 mschenke Exp $
# ARCS: $Header: /home/cvs/cvs/RDA_4/src/scripting/lib/modules/OIDr11.def,v 2.9 2012/01/03 13:34:42 mschenke Exp $
#
# Change History
# 20120103  MSC  Change the copyright notice.

=head1 NAME

OIDr11 - Defines Common Macros for Oracle Internet Directory 11g

=head1 DESCRIPTION

This persistent submodule regroups macros that are common to Oracle Internet
Directory in Oracle Fusion Middleware 11g.

The following macro is available:

=cut

# Make the module persistent and share macros
keep $KEEP_BLOCK,@SHARE_MACROS
var @SHARE_MACROS = ('collect_oid_instance')

# Load the common macros
run library()

=head2 S<collect_oid_instance($abr,$top,\%cmp)>

This macro collects Oracle Internet Directory instance information.

=cut

macro collect_oid_instance
{var ($abr,$top,\%cmp) = @arg
 import $TAIL

 # Collect the instance database information
 var $env = setEnv('TNS_ADMIN',catDir($top,'config'))
 run OIDinfo(true,true)
 call setEnv('TNS_ADMIN',$env)

 # Collect the instance files
 debug ' - Getting Oracle Internet Directory instance files'
 loop $key (keys(%cmp))
 {var ($typ,$cmp) = split('\|',$key,2)
  next !match($typ,'^oidmon$',true)
  debug '   - ',$cmp,' component'
  call setAbbr(concat($abr,'_c_',$cmp))
  pretoc "2:'",$cmp,"' OID Component"

  # Collect the config files
  pretoc '3:Configuration Files'
  call sort_files(4,$TAIL,\
   grepDir(catDir($top,'config','OID',$cmp),'\.(conf|properties|xml)$','dir'))
  unpretoc

  # Collect the log files
  pretoc '3:Log Files'
  var $dir = catDir($top,'diagnostics','logs','OID',$cmp)
  call sort_files(4,$TAIL,\
   grepDir($dir,'^oid((ldapd|mon|repld|stack).*\.log|mon_stack.*\.dmp)$',\
           'inp'),\
   grepDir(catDir($top,'OID','load'),'.','p'),\
   grepDir(catDir($top,'diagnostics','logs','OID','tools'),'\.log$','p'))
  unpretoc 2
 }
 call setAbbr($abr)
}

=head1 SEE ALSO

L<library.def|modules::library>

=begin credits

=over 10

=item RDA 4.15: Greg Cook, Andrew Salt.

=item RDA 4.20: Hector Viveros.

=back

=end credits

=head1 COPYRIGHT NOTICE

Copyright (c) 2002, 2012, Oracle and/or its affiliates. All rights reserved.

=head1 TRADEMARK NOTICE

Oracle and Java are registered trademarks of Oracle and/or its
affiliates. Other names may be trademarks of their respective owners.

=cut
