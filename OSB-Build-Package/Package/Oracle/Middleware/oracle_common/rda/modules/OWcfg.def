# OWcfg.def: Assists Oracle Waveset Collection Setup
# $Id: OWcfg.def,v 1.2 2012/01/10 13:53:08 mschenke Exp $
# ARCS: $Header: /home/cvs/cvs/RDA_4/src/scripting/lib/modules/OWcfg.def,v 1.2 2012/01/10 13:53:08 mschenke Exp $
#
# Change History
# 20120110  KRA  Improve functionality.

=head1 NAME

OWcfg - Assists Oracle Waveset Collection Setup

=head1 DESCRIPTION

This module provides associated logic for the setup of the Oracle Waveset
collections.

=cut

#------------------------------------------------------------------------------
# Section init: Module initialization
#------------------------------------------------------------------------------
section init

#------------------------------------------------------------------------------
# Section chk_wls_servers: Check which Oracle WebLogic servers are present
#------------------------------------------------------------------------------
section chk_wls_servers

# Determine the associate setup prefix
var $pre = ${AUX.PREFIX}

# Detect the servers
var ($top,@srv) = (getSetting(concat($pre,'_WAS_PATH')))
loop $srv (grepDir(catDir($top,'servers'),'^[^\.]+$','n'))
{if testDir('d',catDir($top,'servers',$srv,'logs'))
  call push(@srv,$srv)
}

# Customize the setup
if @srv
{var ${AUX.dft} = 1
 var ($cnt,$flg,@all,@dft,@itm,%sel) = (0,true)

 # Analyze the previous requests
 var $val = getSetting(concat($pre,'_WLS_SERVERS'))
 if compare('eq',$val,'*')
  var $flg = false
 else
 {loop $srv (split('\|',$val))
   var $sel{$srv} = 1
 }

 # Generate temporary setting
 loop $srv (@srv)
 {call push(@all,$srv)
  call push(@itm,incr($cnt),$srv)
  if and($flg,exists($sel{$srv}))
   call push(@dft,$srv)
 }
 call setTempSetting('TMP_WLS_ALL_SERVERS',join('|',@all))
 call setTempSetting('TMP_WLS_DFT_SERVERS',cond($flg,join('|',@dft),'*'))
 call setTempSetting('TMP_WLS_ITM_SERVERS',join('|',@itm))
}

#------------------------------------------------------------------------------
# Section chk_wsp_servers: Check which IBM WebSphere servers are present
#------------------------------------------------------------------------------
section chk_wsp_servers

# Determine the associate setup prefix
var $pre = ${AUX.PREFIX}

# Detect the servers
var ($top,@srv) = (getSetting(concat($pre,'_WAS_PATH')))
loop $srv (grepDir(catDir($top,'logs'),'^[^\.]+$','n'))
{if testDir('d',catDir($top,'logs',$srv))
  call push(@srv,$srv)
}

# Customize the setup
if @srv
{var ${AUX.dft} = 1
 var ($cnt,$flg,@all,@dft,@itm,%sel) = (0,true)

 # Analyze the previous requests
 var $val = getSetting(concat($pre,'_WSP_SERVERS'))
 if compare('eq',$val,'*')
  var $flg = false
 else
 {loop $srv (split('\|',$val))
   var $sel{$srv} = 1
 }

 # Generate temporary setting
 loop $srv (@srv)
 {call push(@all,$srv)
  call push(@itm,incr($cnt),$srv)
  if and($flg,exists($sel{$srv}))
   call push(@dft,$srv)
 }
 call setTempSetting('TMP_WSP_ALL_SERVERS',join('|',@all))
 call setTempSetting('TMP_WSP_DFT_SERVERS',cond($flg,join('|',@dft),'*'))
 call setTempSetting('TMP_WSP_ITM_SERVERS',join('|',@itm))
}

=head1 COPYRIGHT NOTICE

Copyright (c) 2002, 2012, Oracle and/or its affiliates. All rights reserved.

=head1 TRADEMARK NOTICE

Oracle and Java are registered trademarks of Oracle and/or its
affiliates. Other names may be trademarks of their respective owners.

=cut
