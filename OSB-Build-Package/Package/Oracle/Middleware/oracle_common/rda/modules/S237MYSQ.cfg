# S237MYSQ.cfg: Collects Oracle MySQL Server Information
# $Id: S237MYSQ.cfg,v 1.8 2012/05/11 09:38:31 mschenke Exp $
# ARCS: $Header: /home/cvs/cvs/RDA_4/src/scripting/lib/modules/S237MYSQ.cfg,v 1.8 2012/05/11 09:38:31 mschenke Exp $ 
#
# Copyright (c) 2002, 2012, Oracle and/or its affiliates. All rights reserved.
#
# Change history
# 20120509  KRA  Improve socket setting validation.

###############################################################################
# Collect Oracle MySQL Server setup information
###############################################################################

#------------------------------------------------------------------------------
# Module definition
#------------------------------------------------------------------------------
col=${MYSQ_IN_USE}
dsc="Collects Oracle MySQL Server Information"
exe=MYSQcfg
fam=Cygwin,Unix,Windows
req=S000INI
rpt=MYSQ_IN_USE
ttl="Oracle Product Settings"
var=check_depth

#------------------------------------------------------------------------------
# Setting definitions
#------------------------------------------------------------------------------
[check_depth]
typ=B
alt=force_mysq_tests
dft=${CUR.DEPTH}
dsc="Does the setup flow is through profile?"
nam=-

[force_mysq_tests]
typ=B
alt=MYSQ_IN_USE
dft=0
dsc="Are the Oracle MySQL Server tests required by the profile?"
nam=-
var=mysq_in_use

[mysq_in_use]
typ=B
dft=1
dsc="Is Oracle MySQL Server information requested?"
nam=MYSQ_IN_USE
var=mysq_cfg_u1,mysq_cfg_w1,get_bas_dir,get_dat_dir,chk_db_ins,get_user,\
    check_user,MYSQ_LOOP,MYSQ_SLEEP,MYSQ_TAIL

[MYSQ_IN_USE]
typ=B
dft="<<COND:SELECTED_MODULE,1,RDA_DEFAULT,1,0"
dsc="Is Oracle MySQL Server information requested?"
inp="Do you want RDA to collect Oracle MySQL Server information (Y/N)?"
var=mysq_cfg_u1,mysq_cfg_w1,get_bas_dir,get_dat_dir,chk_db_ins,get_user,\
    check_user,MYSQ_LOOP,MYSQ_SLEEP,MYSQ_TAIL

[mysq_cfg_u1]
typ=F
alt=mysq_cfg_u2
dft="/etc/my.cnf"
dsc="Default MySQL configuration file"
fam=Unix
nam=-TMP_MYSQ_CONFIG
var=MYSQ_CONFIG

[mysq_cfg_u2]
typ=F
alt=MYSQ_CONFIG
dsc="Default MySQL configuration file"
exe=find_config
fam=Unix
nam=-TMP_MYSQ_CONFIG
var=MYSQ_CONFIG

[mysq_cfg_w1]
typ=F
alt=mysq_cfg_w2
dft=${ENV.SYSTEMROOT}/my.ini
dsc="Default MySQL configuration file"
fam=Cygwin,Windows
nam=-TMP_MYSQ_CONFIG
var=MYSQ_CONFIG

[mysq_cfg_w2]
typ=F
alt=mysq_cfg_w3
dft=${ENV.SYSTEMDRIVE}/my.ini
dsc="Default MySQL configuration file"
fam=Cygwin,Windows
nam=-TMP_MYSQ_CONFIG
var=MYSQ_CONFIG

[mysq_cfg_w3]
typ=F
alt=mysq_dir_w1
dsc="Default MySQL configuration file"
exe=find_config
fam=Cygwin,Windows
nam=-TMP_MYSQ_CONFIG
var=MYSQ_CONFIG

[mysq_dir_w1]
typ=D
alt=mysq_dir_w2
dft=${ENV.PROGRAMFILES}/MySQL
dsc="Default MySQL root directory"
fam=Cygwin,Windows
nam=-TMP_MYSQ_ROOT
var=mysq_cfg_w4

[mysq_dir_w2]
typ=D
alt=mysq_dir_w3
dft=${ENV.ProgramFiles}/MySQL
dsc="Default MySQL root directory"
fam=Cygwin,Windows
nam=-TMP_MYSQ_ROOT
var=mysq_cfg_w4

[mysq_dir_w3]
typ=D
alt=MYSQ_CONFIG
dft=${ENV.ProgramW6432}/MySQL
dsc="Default MySQL root directory"
fam=Cygwin,Windows
nam=-TMP_MYSQ_ROOT
var=mysq_cfg_w4

[mysq_cfg_w4]
typ=F
alt=MYSQ_CONFIG
dft="<<Search:TMP_MYSQ_ROOT:r2:^my\.ini$"
dsc="Default MySQL configuration file"
fam=Cygwin,Windows
nam=-TMP_MYSQ_CONFIG
var=MYSQ_CONFIG

[MYSQ_CONFIG]
typ=F
dft=${TMP_MYSQ_CONFIG}
dsc="Oracle MySQL Server configuration file"
err="Warning: The specified file does not -yet- exist"
inp="Enter the full path of the Oracle MySQL Server configuration file"
val=W

#------------------------------------------------------------------------------
# Identify the MySQL base directory
#------------------------------------------------------------------------------
[get_bas_dir]
typ=D
alt=set_bas_dir2
dsc="Get the Oracle MySQL Server base directory from the configuration file"
exe=get_bas_dir
nam=-TMP_MYSQ_BASE
var=set_bas_dir1

[set_bas_dir1]
typ=D
dft=${MYSQ_HOME:${TMP_MYSQ_BASE}}
dsc="Oracle MySQL Server base directory"
err="Warning: The specified directory does not -yet- exist"
inp="Enter the full path of the Oracle MySQL Server base directory"
lvl=1
nam=MYSQ_HOME
val=W

[set_bas_dir2]
typ=D
dft=${MYSQ_HOME}
dsc="Oracle MySQL Server base directory"
err="Warning: The specified directory does not -yet- exist"
inp="Enter the full path of the Oracle MySQL Server base directory"
nam=MYSQ_HOME
val=W

#------------------------------------------------------------------------------
# Identify the MySQL data directory
#------------------------------------------------------------------------------
[get_dat_dir]
typ=D
alt=set_dat_dir2
dsc="Get the Oracle MySQL Server data directory from the configuration file"
exe=get_dat_dir
nam=-TMP_MYSQ_DATA
var=set_dat_dir1

[set_dat_dir1]
typ=D
dft=${MYSQ_DATA_DIR:${TMP_MYSQ_DATA}}
dsc="Oracle MySQL Server data directory"
err="Warning: The specified directory does not -yet- exist"
inp="Enter the full path of the Oracle MySQL Server data directory"
lvl=1
nam=MYSQ_DATA_DIR
val=W

[set_dat_dir2]
typ=D
dft=${MYSQ_DATA_DIR}
dsc="Oracle MySQL Server data directory"
err="Warning: The specified directory does not -yet- exist"
inp="Enter the full path of the Oracle MySQL Server data directory"
nam=MYSQ_DATA_DIR
val=W

#------------------------------------------------------------------------------
# Select the database server instance
#------------------------------------------------------------------------------
[chk_db_ins]
typ=B
alt=mysq_protocol_u2,mysq_protocol_w2,check_protocol
dft=0
dsc="Check which database server instance are present in the config file"
exe=chk_db_ins
nam=-
var=mysq_db_ins,chk_con_det

[mysq_db_ins]
typ=M
ask=0
bef="Oracle MySQL Server instance list:"
dft="${TMP_DFT_DB_INS}"
dsc="Database server instance"
err="Enter a menu item number only"
inp="Enter the number corresponding to the server instance name"
itm="${TMP_ITM_DB_INS}"
mnu="<<I"
nam=MYSQ_DB_INS
rsp="^"
val=E

[chk_con_det]
typ=B
alt=mysq_protocol_u2,mysq_protocol_w2,check_protocol
dft=0
dsc="Check which database parameters are present in the config file"
exe=chk_con_det
nam=-
var=exist_protocol,check_protocol

[exist_protocol]
typ=I
alt=mysq_protocol_u2,mysq_protocol_w2
dft="exists:TMP_PROTOCOL"
dsc="Check if client protocol can be deduced from config file"
nam=-
var=mysq_protocol_u1,mysq_protocol_w1

[mysq_protocol_u1]
typ=T
dft="${MYSQ_PROTOCOL:${TMP_PROTOCOL:TCP}}"
dsc="Database client protocol"
err="Error: Supported SOCKET or TCP"
fam=Unix
inp="Enter the database client protocol"
lvl=1
nam=MYSQ_PROTOCOL
ref="^(SOCKET|TCP)$"
val=F

[mysq_protocol_u2]
typ=T
dft="${MYSQ_PROTOCOL:TCP}"
dsc="Database client protocol"
err="Error: Supported SOCKET or TCP"
fam=Unix
inp="Enter the database client protocol"
nam=MYSQ_PROTOCOL
ref="^(SOCKET|TCP)$"
val=F

[mysq_protocol_w1]
typ=T
dft="${MYSQ_PROTOCOL:${TMP_PROTOCOL:TCP}}"
dsc="Database client protocol"
err="Error: Supported MEMORY, PIPE, or TCP"
fam=Cygwin,Windows
inp="Enter the database client protocol"
lvl=1
nam=MYSQ_PROTOCOL
ref="^(MEMORY|PIPE|TCP)$"
val=F

[mysq_protocol_w2]
typ=T
dft="${MYSQ_PROTOCOL:TCP}"
dsc="Database client protocol"
err="Error: Supported MEMORY, PIPE, or TCP"
fam=Cygwin,Windows
inp="Enter the database client protocol"
nam=MYSQ_PROTOCOL
ref="^(MEMORY|PIPE|TCP)$"
val=F

[check_protocol]
typ=I
dft="decode:MYSQ_PROTOCOL:MEMORY:exist_memory:\
                          PIPE:exist_pipe:\
                          SOCKET:exist_socket:\
                          TCP:exist_port"
dsc="Apply the protocol-related setup"
nam=-

#------------------------------------------------------------------------------
# Identify the MySQL shared memory
#------------------------------------------------------------------------------
[exist_memory]
typ=I
alt=mysq_memory2
dft="exists:TMP_MEMORY"
dsc="Check for shared memory base name in config file"
nam=-
var=mysq_memory1

[mysq_memory1]
typ=T
dft="${MYSQ_MEMORY:${TMP_MEMORY:MYSQL}}"
dsc="Database shared memory base name"
fam=Cygwin,Windows
inp="Enter the database shared memory base name"
lvl=1
nam=MYSQ_MEMORY

[mysq_memory2]
typ=T
dft="${MYSQ_MEMORY:MYSQL}"
dsc="Database shared memory base name"
fam=Cygwin,Windows
inp="Enter the database shared memory base name"
nam=MYSQ_MEMORY

#------------------------------------------------------------------------------
# Identify the MySQL pipe
#------------------------------------------------------------------------------
[exist_pipe]
typ=I
alt=mysq_pipe2
dft="exists:TMP_SOCKET"
dsc="Check for named pipe in config file"
nam=-
var=mysq_pipe1

[mysq_pipe1]
typ=T
dft="${MYSQ_PIPE:${TMP_SOCKET:MySQL}}"
dsc="Database named pipe"
fam=Cygwin,Windows
inp="Enter the named pipe"
lvl=1
nam=MYSQ_PIPE

[mysq_pipe2]
typ=T
dft="${MYSQ_PIPE:MySQL}"
dsc="Database named pipe"
fam=Cygwin,Windows
inp="Enter the named pipe"
nam=MYSQ_PIPE

#------------------------------------------------------------------------------
# Identify the MySQL socket
#------------------------------------------------------------------------------
[exist_socket]
typ=I
alt=mysq_socket2
dft="exists:TMP_SOCKET"
dsc="Check for socket file in config file"
nam=-
var=check_socket

[check_socket]
typ=F
alt=mysq_socket2
dft=${TMP_SOCKET}
dsc="Database socket file"
fam=Unix
nam=-
ref="S"
var=mysq_socket1

[mysq_socket1]
typ=F
dft="${MYSQ_SOCKET:${TMP_SOCKET}}"
dsc="Database socket file"
err="The file is not a socket or the path is not absolute"
fam=Unix
inp="Enter the full path of the socket file"
lvl=1
nam=MYSQ_SOCKET
ref="AS"
val=E

[mysq_socket2]
typ=F
dft="${MYSQ_SOCKET:/tmp/mysql.sock}"
dsc="Database socket file"
err="The file is not a socket or the path is not absolute"
fam=Unix
inp="Enter the full path of the socket file"
nam=MYSQ_SOCKET
ref="AS"
val=E

#------------------------------------------------------------------------------
# Identify the MySQL port
#------------------------------------------------------------------------------
[exist_port]
typ=I
alt=mysq_port2
dft="exists:TMP_PORT"
dsc="Check for client port in config file"
nam=-
var=mysq_port1

[mysq_port1]
typ=N
dft=${MYSQ_PORT:${TMP_PORT:3306}}
dsc="Database client port"
err="The port number must be an integer number between 1 and 65535"
inp="Enter the database client port"
lvl=1
nam=MYSQ_PORT
ref="I[1,65535]"
val=F

[mysq_port2]
typ=N
dft=${MYSQ_PORT:3306}
dsc="Database client port"
err="The port number must be an integer number between 1 and 65535"
inp="Enter the database client port"
nam=MYSQ_PORT
ref="I[1,65535]"
val=F

#------------------------------------------------------------------------------
# Identify the MySQL user
#------------------------------------------------------------------------------
[get_user]
typ=T
dsc="Get the Oracle MySQL Server user name from the configuration file"
exe=get_user
nam=-TMP_MYSQL_USER

[check_user]
typ=I
alt=set_user2
dft="match:TMP_MYSQL_USER:\S"
dsc="Check whether the Oracle MySQL Server user is specified"
nam=-
var=set_user1

[set_user1]
typ=T
clr=-
dft=${MYSQ_USER:${TMP_MYSQL_USER}}
dsc="Oracle MySQL Server user name"
err="The user name should not contain spaces"
inp="Enter the user name for the Oracle MySQL Server connection. If a dash \
     ('${clr}') is specified as input, default user name retrieved from \
     the configuration file is considered."
lvl=1
nam=MYSQ_USER
ref="^\S*$"
val=E

[set_user2]
typ=T
dft=${MYSQ_USER}
dsc="Oracle MySQL Server user name"
err="The user name should not contain spaces"
inp="Enter the user name for the Oracle MySQL Server connection"
nam=MYSQ_USER
ref="^\S+$"
val=E

#------------------------------------------------------------------------------
# Other setting definitions
#------------------------------------------------------------------------------
[MYSQ_LOOP]
typ=N
dft=3
dsc="Number of database snapshot iterations"
err="The number of iterations must be a positive integer"
inp="Enter the number of database snapshot iterations to perform"
lvl=1
ref="I[0,["
val=F

[MYSQ_SLEEP]
typ=N
dft=30
dsc="Number of seconds to sleep between each database snapshot"
err="The number of seconds must be a positive integer"
inp="Enter the wait time (in seconds) between each database snapshot"
lvl=1
ref="I[0,["
val=F

[MYSQ_TAIL]
typ=N
dft=5000000
dsc="Maximum number of lines to extract from each log file"
err="The number of lines must be an integer greater than zero"
inp="How many lines do you want RDA to extract starting from the end of each \
     log file?"
lvl=1
ref="I]0,["
val=F
