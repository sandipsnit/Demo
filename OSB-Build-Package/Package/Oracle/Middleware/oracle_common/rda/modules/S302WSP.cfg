# S302WSP.cfg: Collects IBM WebSphere Application Server Information
# $Id: S302WSP.cfg,v 1.4 2012/01/02 17:25:16 mschenke Exp $
# ARCS: $Header: /home/cvs/cvs/RDA_4/src/scripting/lib/modules/S302WSP.cfg,v 1.4 2012/01/02 17:25:16 mschenke Exp $
#
# Copyright (c) 2002, 2012, Oracle and/or its affiliates. All rights reserved.
#
# Change history
# 20120102  MSC  Change the copyright notice.

###############################################################################
# Collect the IBM WebSphere Application Server setup information
###############################################################################

#------------------------------------------------------------------------------
# Module definition
#------------------------------------------------------------------------------
col=${WSP_IN_USE}
dsc="Collects IBM WebSphere Application Server Information"
exe=WSPsetup
req=S000INI
rpt=WSP_IN_USE
ttl="Oracle Product Settings"
var=force_wsp_tests

#------------------------------------------------------------------------------
# Setting definitions
#------------------------------------------------------------------------------
[force_wsp_tests]
typ=B
alt=WSP_IN_USE
dft=0
dsc="Are the IBM WebSphere Application Server tests required by the profile?"
nam=-
var=wsp_in_use

[no_wsp]
typ=B
dft=0
dsc="Is IBM WebSphere Application Server information requested?"
nam=WSP_IN_USE

[wsp_in_use]
typ=B
dft=1
dsc="Is IBM WebSphere Application Server information requested?"
nam=WSP_IN_USE
var=WSP_PROFILE_ROOT

[WSP_IN_USE]
typ=B
dft=${RDA_DEFAULT:0}
dsc="Is IBM WebSphere Application Server information requested?"
inp="Do you want RDA to analyze IBM WebSphere Application Server (Y/N)?"
var=WSP_PROFILE_ROOT

[WSP_PROFILE_ROOT]
typ=D
dsc="Profile root directory"
err="Warning: The specified directory does not -yet- exist"
inp="Enter the location of the directory where the profiles to analyze are \
     located"
val=W
var=chk_cells

[chk_cells]
typ=B
alt=wsp_comment,no_wsp
dft=0
dsc="Get the directories present in the profile root directory"
exe=get_cells
nam=-
var=WSP_TYPE

[wsp_comment]
typ=C
dsc="Report bad IBM WebSphere Application Server profile root directory"
inp="The specified profile root directory is either invalid or does not \
     contain some IBM WebSphere Application Server related-files. The \
     collection is disabled.\n\n\
     Hit 'Return' to continue"

[WSP_TYPE]
typ=M
bef="Data Collection Type:"
dft=OFF
dsc="Collection type"
err="Please enter a number from 1 to 3"
hlp="For a successful WAS connection, ensure that the DeploymentManager/\
     Standalone Server process is up and running."
inp="\nEnter the item number"
itm="1|Collect for a single server (offline mode)|\
     2|Collect for a single server (using WAS connection)|\
     3|Collect for multiple servers (using WAS connection)"
mnu="<<N"
rsp="1|OFF|2|ONE|3|MANY"
val=F
var=wsp_type

[wsp_type]
typ=I
dft="decode:WSP_TYPE:\
     OFF:ask_one_cell,ask_one_server,wsp_homes:\
     ONE:ask_one_cell,ask_one_server,WSP_AUTH_AUTO,wsp_homes,WSP_INCIDENTS:\
     MANY:ask_cells,ask_servers,WSP_AUTH_AUTO,wsp_homes,WSP_INCIDENTS"
dsc="Apply the type-related setup"
nam=-

#------------------------------------------------------------------------------
# Select the cell(s)
#------------------------------------------------------------------------------
[ask_one_cell]
typ=M
ask=0
bef="Profile:Cell list:"
dft=${WSP_CELLS}
dsc="Profile:Cell list"
err="Enter a menu item number only"
exe=get_cell_items
inp="Enter the number corresponding to the selected profile:cell name"
itm=""
mnu="<<N"
nam=WSP_CELLS
rsp="^"
val=E

[ask_cells]
typ=M
bef="Profile:Cell list:"
dft=${WSP_CELLS}
dup="Profile:Cell already selected"
dsc="Profile:Cell list"
end="."
err="Enter a menu item number only"
exe=get_cell_items
inp="Enter the number corresponding to the profile:cell name or ${end} to \
     terminate the list"
itm="0|*All*"
mnu="<<N"
nam=WSP_CELLS
one="*All*"
rsp="^"
sep="|"
val=E

#------------------------------------------------------------------------------
# Select the server(s)
#------------------------------------------------------------------------------
[ask_one_server]
typ=M
ask=0
bef="Profile:Cell:Node:Server list:"
dft=${WSP_SERVERS}
dsc="Profile:Cell:Node:Server list"
err="Enter a menu item number only"
exe=get_server_items
inp="Enter the number corresponding to the profile:cell:node:server name"
itm=""
mnu="<<N"
nam=WSP_SERVERS
rsp="^"
val=E

[ask_servers]
typ=M
bef="Profile:Cell:Node:Server list:"
dft=${WSP_SERVERS}
dup="Profile:Cell:Node:Server already selected"
dsc="Profile:Cell:Node:Server list"
end="."
err="Enter a menu item number only"
exe=get_server_items
inp="Enter the number corresponding to the profile:cell:node:server name or \
     ${end} to terminate the list"
itm="0|*All*"
mnu="<<N"
nam=WSP_SERVERS
one="*All*"
rsp="^"
sep="|"
val=E

#------------------------------------------------------------------------------
# Identify the users
#------------------------------------------------------------------------------
[WSP_AUTH_AUTO]
typ=B
alt=wsp_cell_ids,set_loop1
dft=${RDA_DEFAULT:0}
dsc="Use properties file for connecting to IBM WebSphere?"
inp="Do you want RDA to use the authentication details stored in the \
     properties file when connecting to IBM WebSphere (Y/N)?"
lvl=1

[wsp_cell_ids]
typ=T
dsc="Cell identifiers"
exe=get_cell_ids
nam=WSP_CELL_IDS

[set_loop1]
typ=L
dft="${WSP_CELL_IDS}"
dsc="Examine all directories"
nam=-item
sep="|"
var=set_cell,get_prof,get_cell,get_user

[set_cell]
typ=T
dft="${WSP_CELL_${item}}"
dsc="Cell (${item})"
nam=WSP_CELL_${item}

[get_prof]
typ=I
dft="re:WSP_CELL_${item}:(.*):"
dsc="Retrieve the profile"
nam=-pro

[get_cell]
typ=I
dft="re:WSP_CELL_${item}:.*:(.*)$"
dsc="Retrieve the cell"
nam=-cel

[get_user]
typ=F
dft="${WSP_PROFILE_ROOT}/${pro}/config/cells/${cel}/fileRegistry.xml"
dsc="Check if IBM WebSphere cell environment file is present"
nam=-TMP_ENV_FILE
var=find_user,check_user

[find_user]
typ=T
dft='<<XML:TMP_ENV_FILE::\
       sdo:datagraph/wim:Root/wim:entities xsi:type="wim:PersonAccount"/wim:uid'
dsc="Get the IBM WebSphere user name from configuration file"
nam=-TMP_WSP_USER

[check_user]
typ=I
alt=set_user2,set_last_user
dft="match:TMP_WSP_USER:\S"
dsc="Check whether the IBM WebSphere user is specified"
nam=-
var=set_user1,set_last_user

[set_user1]
typ=T
clr=-
dft=${WSP_USER_${item}:${TMP_LAST_USER:${TMP_WSP_USER}}}
dsc="IBM WebSphere user name for '${WSP_CELL_${item}}' cell"
err="The user name should not contain spaces"
inp="Enter the user name for the IBM WebSphere connection. If a dash \
     ('${clr}') is specified as input, default user name retrieved from \
     '${WSP_CELL_${item}}' cell configuration file is considered."
lvl=1
nam=WSP_USER_${item}
ref="^\S*$"
val=E

[set_user2]
typ=T
dft=${WSP_USER_${item}:${TMP_LAST_USER}}
dsc="IBM WebSphere user name for '${WSP_CELL_${item}}' cell"
err="The user name should not contain spaces"
inp="Enter the user name for the IBM WebSphere connection for \
     '${WSP_CELL_${item}}' cell"
nam=WSP_USER_${item}
ref="^\S+$"
val=E

[set_last_user]
typ=T
dft="${WSP_USER_${item}}"
dsc="Last IBM WebSphere user name entered"
nam=-TMP_LAST_USER

#------------------------------------------------------------------------------
# Setting definition for determining all relevant WSP homes
#------------------------------------------------------------------------------
[wsp_homes]
typ=T
dsc="Oracle home or IBM WebSphere installation directory"
exe=get_home_list
nam=WSP_HOMES

#------------------------------------------------------------------------------
# Other settings
#------------------------------------------------------------------------------
[WSP_INCIDENTS]
typ=N
dft=10
dsc="Number of server diagnostic incidents to capture"
err="The number must be a positive integer"
inp="Enter the maximum number of incidents to capture"
lvl=1
ref="I[0,["
val=F
