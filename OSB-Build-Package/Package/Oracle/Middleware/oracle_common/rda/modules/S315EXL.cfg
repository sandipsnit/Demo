# S315EXL.cfg: Collects Oracle Exalogic Information
# $Id: S315EXL.cfg,v 1.5 2012/08/17 12:39:38 mschenke Exp $
# ARCS: $Header: /home/cvs/cvs/RDA_4/src/scripting/lib/modules/S315EXL.cfg,v 1.5 2012/08/17 12:39:38 mschenke Exp $
#
# Copyright (c) 2002, 2012, Oracle and/or its affiliates. All rights reserved.
#
# Change history
# 20120816  KRA  Extend Oracle Exalogic environment detection.

###############################################################################
# Collect the Oracle Exalogic Setup Information
###############################################################################

#------------------------------------------------------------------------------
# Module definition
#------------------------------------------------------------------------------
col=${EXL_IN_USE}
dsc="Collects Oracle Exalogic Information"
exe=EXLcfg
req=S000INI
rpt=EXL_IN_USE
ttl="Oracle Product Settings"
var=check_exl1

#------------------------------------------------------------------------------
# Setting definitions
#------------------------------------------------------------------------------
[check_exl1]
typ=F
alt=check_exl2
dft="/usr/lib/init-exalogic-node/.image_id"
dsc="Check if '/usr/lib/init-exalogic-node/.image_id' file exists"
nam=-
var=force_exl_tests

[check_exl2]
typ=D
alt=no_exl
dft="/opt/exalogic.tools"
dsc="Check if exalogic.tools directory exists"
nam=-
var=force_exl_tests

[no_exl]
typ=B
dft=0
dsc="Is Oracle Exalogic in use?"
nam=EXL_IN_USE

[force_exl_tests]
typ=B
alt=EXL_IN_USE
dft=0
dsc="Is the Oracle Exalogic collection required by the profile?"
nam=-
var=exl_in_use

[exl_in_use]
typ=B
dft=1
dsc="Is Oracle Exalogic in use?"
nam=EXL_IN_USE
var=check_profile,check_type,EXL_TAIL,exl_ssh_comment

[EXL_IN_USE]
typ=B
dft="<<COND:SELECTED_MODULE,1,RDA_DEFAULT,1,0"
dsc="Is Oracle Exalogic in use?"
inp="Do you want to collect Oracle Exalogic information (Y/N)?"
var=check_profile,check_type,EXL_TAIL,exl_ssh_comment

[check_profile]
typ=I
alt=EXL_TYPE
dft="exists:exl_type"
dsc="Profile based variable exists?"
nam=-
var=select_type

[select_type]
typ=T
dft="${exl_type}"
dsc="Collection type"
nam=EXL_TYPE

[EXL_TYPE]
typ=M
bef="Exalogic collection type:"
dft="^"
dsc="Collection type"
err="Enter a menu item number only"
inp="Enter the number corresponding to the collection type"
itm="0|All diagnostic information|\
     1|Drive failure issue|\
     2|Gateway issue|\
     3|Hardware and Software health issue|\
     4|Network health issue|\
     5|IB fabric issue|\
     6|IB switch issue|\
     7|ILOM issue|\
     8|General network issue|\
     9|Image patches issue|\
     10|RAID card issue|\
     11|Ambient temperature issue"
mnu="<<N"
rsp="0|_All_|\
     1|_DriveFailure_|\
     2|_Gateway_|\
     3|_HealthHwSw_|\
     4|_HealthNetwork_|\
     5|_IbFabric_|\
     6|_IbSwitch_|\
     7|_Ilom_|\
     8|_Network_|\
     9|_Patch_|\
     10|_Raid_|\
     11|_Temp_"
val=E

[check_type]
typ=I
dft="decode:EXL_TYPE:\
     _All_:chk_nodes,EXL_COLLECT_SWITCH:\
     _DriveFailure_:chk_nodes:\
     _Gateway_:EXL_COLLECT_SWITCH:\
     _HealthHwSw_:chk_nodes:\
     _HealthNetwork_:chk_nodes:\
     _IbFabric_:chk_nodes:\
     _IbSwitch_:EXL_COLLECT_SWITCH:\
     _Ilom_:chk_nodes:\
     _Network_:chk_nodes:\
     _Patch_:chk_nodes:\
     _Raid_:chk_nodes:\
     _Temp_:chk_nodes"
dsc="Apply the type-related setup"
nam=-

[chk_nodes]
typ=B
dft=0
dsc="Check which nodes are present to analyze"
exe=chk_nodes
nam=-
var=EXL_COLLECT_NODE

[EXL_COLLECT_NODE]
typ=B
dft=1
dsc="Should we collect diagnostic information from remote nodes?"
inp="Do you want to collect diagnostic information from remote nodes (Y/N)?"
lvl=1
var=select_nodes,chk_selection

[select_nodes]
typ=M
ask=0
bef="Exalogic node list:"
col=1
dft="${TMP_DFT_NODES}"
dsc="Node list"
err="The item list is invalid. Entering the number for the first item, \
     separated from the number for the next item by a comma (,), and so on \
     down the list of items. When there are several consecutive items you wish \
     to select, you can select them by entering the first number, dash (-), \
     the last number."
inp="Enter the nodes to collect, as a comma-separated list of item numbers \
     or ranges"
itm="${TMP_ITM_NODES}"
mnu="<<N"
nam=EXL_NODES
pck=1
rsp="^"
sep="|"
val=E

[chk_selection]
typ=I
alt=EXL_LOGIN,EXL_WAIT_PWD
dft="match:EXL_NODES:^\s*$"
dsc="Skip when the node menu is empty"
nam=-

[EXL_LOGIN]
typ=T
dft='oracle'
dsc="User to log in as on remote nodes"
inp="Enter the user to login as on remote nodes"

[EXL_WAIT_PWD]
typ=N
dft=30
dsc="Number of seconds to wait between password prompts for nodes"
err="The number of seconds must be an integer greater than zero"
inp="Enter the number of seconds to wait between password prompts for \
     connecting to nodes"
lvl=1
ref="I]0,["
val=F

[EXL_COLLECT_SWITCH]
typ=B
dft=1
dsc="Should we collect switch information using remote connection?"
inp="Do you want to collect switch information using remote connection (Y/N)?"
lvl=1
var=EXL_SWITCH_LOGIN,EXL_SWITCH_WAIT_PWD,check_user

[EXL_SWITCH_LOGIN]
typ=T
dsc="User to log in as on remote switches"
inp="Enter the user to login as on remote switches"

[EXL_SWITCH_WAIT_PWD]
typ=N
dft=30
dsc="Number of seconds to wait between password prompts for switches"
err="The number of seconds must be an integer greater than zero"
inp="Enter the number of seconds to wait between password prompts for \
     connecting to switches"
lvl=1
ref="I]0,["
val=F

[check_user]
typ=B
dft=${CUR.UID}
dsc="Check if it is root user"
fam=Unix
nam=-
var=exl_switch_comment

[exl_switch_comment]
typ=C
dsc="Report to execute TLroot to complete the collection"
fam=Unix
inp="WARNING: Collecting switch information requires superuser privileges.\n\n\
     When the normal collection is complete, switch to root and execute the \
     TLroot tool with a command like:\n\
     \040\040${RDA_SELF} -vdT root\n\
     Next, switch back to the previous user to package the results with a \
     command like:\n\
     \040\040${RDA_SELF} -vP\n\n\
     Hit 'Return' to continue"

[EXL_TAIL]
typ=N
dft=1000
dsc="Default number of lines to be collected from log files"
err="The number of lines must be an integer greater than zero"
inp="Enter the default number of lines to be collected from log files"
lvl=9
ref="I]0,["
val=F

[exl_ssh_comment]
typ=C
dsc="Report to execute ssh manually before RDA"
fam=Unix
inp="NOTE: Collecting remote information requires ssh connection.\n\n\
     Take care that RDA does not perform the first connection to a remote \
     host. Run first ssh manually to verify the remote's host finger print \
     and to accept connecting to it.\n\n\
     Hit 'Return' to continue"
