# S545EPM.cfg: Collects Enterprise Peformance Management System Information 
# $Id: S545EPM.cfg,v 1.15 2012/08/29 17:04:59 mschenke Exp $
# ARCS: $Header: /home/cvs/cvs/RDA_4/src/scripting/lib/modules/S545EPM.cfg,v 1.15 2012/08/29 17:04:59 mschenke Exp $
#
# Copyright (c) 2002, 2012, Oracle and/or its affiliates. All rights reserved.
#
# Change history
# 20120829  KRA  Improve setup.

###############################################################################
# Collects common Oracle Enterprise Performance Management setup information
###############################################################################

#------------------------------------------------------------------------------
# Module definition
#------------------------------------------------------------------------------
col=${EPM_IN_USE}
dsc="Collects Enterprise Performance Management System Information"
env=DOMAIN_HOME,EPM_ORACLE_INSTANCE
exe=EPMcfg
fam=Cygwin,Unix,Windows
req=S000INI,*?EPM_REQ_WREQ:S301WREQ,*?EPM_REQ_IREQ:S313IREQ
rpt=EPM_IN_USE
trg=?EPM_REQ_WREQ:S301WREQ,?EPM_REQ_IREQ:S313IREQ
ttl="Oracle Product Settings"
var=check_depth

#------------------------------------------------------------------------------
# Setting definitions
#------------------------------------------------------------------------------
[check_depth]
typ=B
alt=force_epm_tests
dft=${CUR.DEPTH}
dsc="Does the setup flow is through profile?"
nam=-
var=ORACLE_PARENT,check_ofm

#------------------------------------------------------------------------------
# Setting definitions for INI-based module
#------------------------------------------------------------------------------
[ORACLE_PARENT]
typ=D
dft=${ENV.BEA_HOME}
dsc="Oracle Middleware home"
err="Warning: The specified directory does not -yet- exist"
inp="Enter the Oracle Middleware home to be used for data analysis"
val=W

[check_ofm]
typ=F
alt=mw_comment
dft="${ORACLE_PARENT}/registry.xml"
dsc="Is a valid OFM environment?"
nam=-
var=dft_dom_home,dft_ora_home,dft_instance_root,dft_java_home

[mw_comment]
typ=C
dsc="Report bad Oracle Middleware home directory"
inp="The specified Middleware home directory is either invalid or does not \
     contain some Oracle WebLogic related-files. The collection is \
     disabled. Rerun the setup with the correct Middleware home directory.\n\n\
     Hit 'Return' to continue"
val=F

[dft_dom_home]
typ=D
dft="${ORACLE_PARENT}/user_projects/domains/EPMSystem"
dsc="Default domain home directory"
nam=-TMP_DOMAIN_HOME
var=domain_home

[domain_home]
typ=D
dft=${TMP_DOMAIN_HOME}
dsc="Domain home directory"
nam=DOMAIN_HOME

[dft_ora_home]
typ=D
dft="<<SEARCH:ORACLE_PARENT:p:^EPMSystem11"
dsc="Default Oracle home directory"
nam=-TMP_ORACLE_HOME
var=oracle_home

[oracle_home]
typ=D
dft=${TMP_ORACLE_HOME}
dsc="Oracle home"
nam=ORACLE_HOME

[dft_instance_root]
typ=D
dft="${ORACLE_PARENT}/user_projects"
dsc="Default instance root directory"
nam=-TMP_INSTANCE_ROOT
var=instance_root

[instance_root]
typ=D
dft=${TMP_INSTANCE_ROOT}
dsc="Instance root directory"
nam=INSTANCE_ROOT

[dft_java_home]
typ=D
dft="<<SEARCH:ORACLE_PARENT:p:^(jdk\d+|jrockit_\d+)"
dsc="Default java home"
nam=-TMP_JAVA_HOME
var=java_home

[java_home]
typ=D
dft=${TMP_JAVA_HOME}
dsc="Java home"
nam=JAVA_HOME

#------------------------------------------------------------------------------
# Setting definitions for EPM-based setup
#------------------------------------------------------------------------------
[force_epm_tests]
typ=B
alt=EPM_IN_USE
dft=0
dsc="Are the EPM tests required by the profile?"
nam=-
var=epm_in_use

[epm_in_use]
typ=B
dft=1
dsc="Is Enterprise Performance Management application information requested?"
nam=EPM_IN_USE
var=chk_wls_hom,EPM_LOG_AGE

[EPM_IN_USE]
typ=B
dft="<<COND:SELECTED_MODULE,1,RDA_DEFAULT,1,0"
dsc="Is Enterprise Performance Management application information requested?"
inp="Do you want RDA to analyze Enterprise Performance Management (Hyperion) \
     products (Y/N)?"
var=chk_wls_hom,EPM_LOG_AGE

#------------------------------------------------------------------------------
# Select EPM home from various default location
#------------------------------------------------------------------------------
[chk_wls_hom]
typ=D
alt=chk_epm_cfg2_u,chk_epm_cfg2_w
dft="<<Search:ORACLE_PARENT:p:^wlserver_\d"
dsc="Check for Oracle WebLogic server install home"
nam=-TMP_WL_HOME
var=chk_epm_cfg1

[chk_epm_cfg1]
typ=F
alt=chk_epm_cfg2_u,chk_epm_cfg2_w
dft=${TMP_WL_HOME}/.product.properties
dsc="Configuration file containing the Hyperion home"
nam=-TMP_EPM_CFG
var=epm_cfg_hom1_u,epm_cfg_hom1_w

[chk_epm_cfg2_u]
typ=F
alt=chk_epm_cfg3_u
dft=${ENV.HOME}/.oracle.instances
dsc="Configuration file containing the Oracle instance home"
fam=Unix
nam=-TMP_EPM_CFG
var=epm_ins_hom

[chk_epm_cfg2_w]
typ=F
alt=chk_epm_ora_hom1
dft=${ENV.USERPROFILE}/.oracle.instances
dsc="Configuration file containing the Oracle instance home"
fam=Cygwin,Windows
nam=-TMP_EPM_CFG
var=epm_ins_hom

[chk_epm_cfg3_u]
typ=F
alt=chk_epm_cfg4_u
dft=${ENV.HOME}/.hyperion.${RDA.HOST}
dsc="Configuration file containing the Hyperion home"
fam=Unix
nam=-TMP_EPM_CFG
var=epm_cfg_hom1_u

[chk_epm_cfg4_u]
typ=F
alt=chk_epm_ora_hom1
dft=${ENV.HOME}/.hyperion.${RDA.NODE}
dsc="Configuration file containing the Hyperion home"
fam=Unix
nam=-TMP_EPM_CFG
var=epm_cfg_hom1_u

[epm_cfg_hom1_u]
typ=D
alt=chk_epm_ora_hom1
dft="<<Config:TMP_EPM_CFG:2:^(EPM_ORACLE|HYPERION)_HOME=(.*?)\s*$"
dsc="EPM Home directory"
fam=Unix
nam=EPM_HOME
var=check_inventory

[epm_cfg_hom1_w]
typ=D
alt=chk_epm_ora_hom1
dft="<<Config:TMP_EPM_CFG:1:^EPM_ORACLE_HOME=(.*?)\s*$"
dsc="EPM Home directory"
fam=Cygwin,Windows
nam=EPM_HOME
var=chk_oracle_instance,EPM_INSTANCE_ROOT

[epm_ins_hom]
typ=D
alt=chk_epm_ora_hom1
dft="<<XML:TMP_EPM_CFG::instances/instance"
dsc="EPM Instance Home directory"
nam=-TMP_EPM_INS_HOME
var=chk_epm_cfg5

[chk_epm_cfg5]
typ=F
alt=chk_epm_ora_hom1
dft="${TMP_EPM_INS_HOME}/bin/${AS.BAT:setEnv}"
dsc="Configuration file containing the Hyperion home"
nam=-TMP_EPM_CFG
var=epm_cfg_hom2_u,epm_cfg_hom2_w

[epm_cfg_hom2_u]
typ=D
alt=chk_epm_ora_hom1
dft='<<Config:TMP_EPM_CFG:1:^EPM_ORACLE_HOME="([^"]*)"'
dsc="EPM Home directory"
fam=Unix
nam=EPM_HOME
var=chk_epmsys_registry2,EPM_INSTANCE_ROOT

[epm_cfg_hom2_w]
typ=D
alt=chk_epm_ora_hom1
dft='<<Config:TMP_EPM_CFG:1:^set\s+EPM_ORACLE_HOME=(.*)'
dsc="EPM Home directory"
fam=Cygwin,Windows
nam=EPM_HOME
var=chk_epmsys_registry2,EPM_INSTANCE_ROOT

[chk_epm_ora_hom1]
typ=D
alt=chk_epm_ora_hom2
dft=${ENV.EPM_ORACLE_HOME}
dsc="EPM Home directory"
nam=EPM_HOME
var=chk_oracle_instance,EPM_INSTANCE_ROOT

[chk_epm_ora_hom2]
typ=D
alt=chk_epm_ora_hom3_u,chk_epm_ora_hom3_w
dft=${ENV.HYPERION_HOME}
dsc="EPM Home directory"
nam=EPM_HOME
var=check_epmsys_home

[chk_epm_ora_hom3_u]
typ=D
alt=epm_home,check_epm_home
dft=${ENV.HOME}/hyperion
dsc="EPM Home directory"
fam=Unix
nam=EPM_HOME
var=check_epmsys_home

[chk_epm_ora_hom3_w]
typ=D
alt=epm_home,check_epm_home
dft="C:\Hyperion"
dsc="EPM Home directory"
fam=Cygwin,Windows
nam=EPM_HOME
var=check_epmsys_home

[epm_home]
typ=D
dft=${EPM_HOME}
dsc="EPM Home directory"
err="Warning: The specified directory does not -yet- exist"
inp="Enter the location of the Oracle Enterprise Performance Management \
     (Hyperion) home directory (For example the directory path specified by an \
     EPM_ORACLE_HOME or HYPERION_HOME environment variable)"
nam=-TMP_EPM_HOME
val=W

[check_epm_home]
typ=D
alt=edit_epm_home
dft=${TMP_EPM_HOME}
dsc="EPM Home directory"
nam=-
var=EPM_HOME

[edit_epm_home]
typ=B
alt=no_epm
dft=0
dsc="Do you want to modify the Enterprise Performance Management home location?"
inp="The specified Enterprise Performance Management directory is invalid. \
     The collection will be disabled.\n\n\
     Do you want to modify the Enterprise Performance Management home \
     path (Y/N)?"
nam=-
var=epm_home,check_epm_home

[no_epm]
typ=B
dft=0
dsc="Is Enterprise Performance Management application information requested?"
nam=EPM_IN_USE

[EPM_HOME]
typ=D
dft=${TMP_EPM_HOME}
dsc="EPM Home directory"
var=check_inventory

#------------------------------------------------------------------------------
# Try to get the Web application server information from the EPM home
#------------------------------------------------------------------------------
[check_epmsys_home]
typ=F
alt=check_epm_directory
dft="${EPM_HOME}/common/config/9.5.0.0/${AS.BAT:epmsys_registry}"
dsc="Check ${AS.BAT:epmsys_registry} in EPM home"
nam=-
var=get_was_type,set_prod_domain

[check_epm_directory]
typ=D
dft="${EPM_HOME}/common/config/9.5.0.0"
dsc="Check 9.5.0.0 in EPM home/common/config"
nam=-
var=EPM_WAS_TYPE,check_as_type

[get_was_type]
typ=T
dft=''
dsc="Get Web application Server type"
exe=get_was_type
nam=EPM_WAS_TYPE

[set_prod_domain]
typ=D
alt=missing
dft="${TMP_DOMAIN}"
dsc="Domain Home"
nam=EPM_DOMAIN

#------------------------------------------------------------------------------
# Request the Web application server information
#------------------------------------------------------------------------------
[EPM_WAS_TYPE]
typ=M
cas=0
dft="WLS"
dsc="Web application server type"
err="Enter 1, 2, or 3 only"
inp="Enter the Web application server type"
itm="1|OC4J|2|Oracle Weblogic Server|3|IBM WebSphere"
mnu="<<I"
rsp="1|OC4J|OC4J|OC4J|2|WLS|WLS|WLS|3|WSP|WSP|WSP"
val=E

[check_as_type]
typ=I
dft="decode:EPM_WAS_TYPE:WLS:get_domain"
dsc="Determine which additional information is required"
nam=-

[get_domain]
typ=D
dft=${ENV.DOMAIN_HOME}
dsc="Domain home directory"
err="Warning: The specified directory does not -yet- exist"
inp="Enter the location of the domain home directory"
nam=EPM_DOMAIN
val=W

#------------------------------------------------------------------------------
# Check if instance home is needed
#------------------------------------------------------------------------------
[check_inventory]
typ=D
alt=check_epmsys_home
dft=${EPM_HOME}/inventory
dsc="Check if EPM inventory directory exists"
nam=-
var=chk_oracle_instance,EPM_INSTANCE_ROOT

[chk_oracle_instance]
typ=I
alt=dft_instance_home2
dft="exists:EPM_ORACLE_INSTANCE"
dsc="Check the EPM_ORACLE_INSTANCE environment variable existence"
nam=-
var=chk_epmsys_registry

[chk_epmsys_registry]
typ=F
alt=dft_instance_home2
dft=${EPM_ORACLE_INSTANCE}/bin/${AS.BAT:epmsys_registry}
dsc="Check for ${AS.BAT:epmsys_registry}"
nam=-
var=dft_instance_home1

[chk_epmsys_registry2]
typ=F
dft=${TMP_EPM_INS_HOME}/bin/${AS.BAT:epmsys_registry}
dsc="Check for ${AS.BAT:epmsys_registry}"
nam=-
var=dft_instance_home3

[dft_instance_home1]
typ=D
dft="${EPM_ORACLE_INSTANCE}/.."
dsc="Default instance root directory"
nam=-TMP_INSTANCE_ROOT

[dft_instance_home2]
typ=D
dft="${EPM_HOME}/../user_projects"
dsc="Default instance root directory"
nam=-TMP_INSTANCE_ROOT

[dft_instance_home3]
typ=D
dft="${TMP_EPM_INS_HOME}/.."
dsc="Default instance root directory"
nam=-TMP_INSTANCE_ROOT

[EPM_INSTANCE_ROOT]
typ=D
dft=${TMP_INSTANCE_ROOT}
dsc="Instance root directory"
err="Warning: The specified directory does not -yet- exist"
inp="Enter the location of the directory containing the instance homes to \
     analyze (For example the parent directory of the path specified by an \
     EPM_ORACLE_INSTANCE environment variable)"
val=W
var=chk_instances

[chk_instances]
typ=B
alt=epm_comment
dft=0
dsc="Check which instance homes are present in the instance root directory"
exe=chk_instances
nam=-
var=EPM_SELECTION,epm_instances,set_loop,epm_domains

[epm_comment]
typ=C
dsc="Report bad Oracle instance root directory"
inp="The specified Oracle instance root directory is either invalid or does \
     not contain some enterprise performance management instance homes. \
     Collection will not contain deployment data.\n\n\
     Hit 'Return' to continue"

#------------------------------------------------------------------------------
# Select instances
#------------------------------------------------------------------------------
[EPM_SELECTION]
typ=M
add="*|All instances|*|all_instances"
bef="Instance list:"
col=1
dsc="Instance selection list"
dup="Instance already selected"
end="."
err="Enter a menu item number only"
inp="Enter the number corresponding to the instance directory name, or * to \
     select all instances, or ${end} to terminate the list"
itm="${TMP_ITM_INSTANCES}"
mnu="<<I"
one="*"
rsp="^"
sep="|"
val=E

[all_instances]
typ=T
dft=${TMP_ALL_INSTANCES}
dsc="List all instances"
nam=-EPM_SELECTION

[epm_instances]
dsc="List all instances"
dft=${EPM_SELECTION}
dsc="Instance name list"
nam=EPM_INSTANCES

[set_loop]
typ=L
dft="${EPM_INSTANCES}"
dsc="Examine all instance directories"
nam=-TMP_INSTANCE
sep="|"
var=set_req_instance,get_ins_domain

[set_req_instance]
typ=D
dft="${EPM_INSTANCE_ROOT}/${TMP_INSTANCE}"
dsc="Instance ${TMP_INSTANCE}"
nam=EPM_OI${INC.Instance}_REQ_INSTANCE
var=epm_req_ireq,set_oh_focus,set_oi_focus

[set_oh_focus]
typ=T
dft="HTTP,OPMN"
dsc="Focus areas for Oracle home associated to the instance home"
nam=EPM_OH${CNT.Instance}_FOCUS

[set_oi_focus]
typ=T
dft="HTTP,OPMN"
dsc="Focus areas for instance home"
nam=EPM_OI${CNT.Instance}_FOCUS

[get_ins_domain]
typ=D
alt=ask_ins_domain
dsc="Extract domain home directory from the EPM registry"
exe=get_domain_home
nam=-TMP_DOMAIN
var=add_domain,check_profile

[ask_ins_domain]
typ=D
dft=${DOMAIN_HOME:${LAST_DOMAIN:${ENV.DOMAIN_HOME}}}
dsc="Domain home directory"
err="Warning: The specified directory does not -yet- exist"
inp="Enter the location of the domain home directory"
nam=-TMP_DOMAIN
val=W
var=add_domain,check_profile

[add_domain]
typ=I
dft="join:TMP_HASH:${TMP_INSTANCE}|${TMP_DOMAIN}"
dsc="Add an associated domain"
nam=-TMP_HASH

[epm_req_ireq]
typ=B
dft=1
dsc="Does EPM require Oracle Instance Request Handler collection?"
nam=EPM_REQ_IREQ

[epm_domains]
typ=T
dft="${TMP_HASH}"
dsc="Domain associations"
nam=EPM_DOMAINS

[missing]
typ=B
dsc="Used to reject settings"
nam=-

[check_profile]
typ=B
alt=force_primary
dft=${epm_profile}
dsc="Is it a profile based collection?"
nam=-
var=set_primary

[force_primary]
typ=B
dft=0
dsc="Is EPM the primary module?"
nam=EPM_PRIMARY

[set_primary]
typ=B
dft=${epm_primary}
dsc="Is EPM the primary module?"
nam=EPM_PRIMARY
var=set_req_domain

[set_req_domain]
typ=D
alt=missing
dft=${TMP_DOMAIN}
dsc="Domain associated to ${TMP_INSTANCE}"
nam=EPM_DOM${CNT.Instance}_REQ_DOMAIN
var=chk_servers,epm_req_wreq,set_top_focus,set_dom_focus

[chk_servers]
typ=B
alt=missing
dft=0
dsc="Check which server homes are present in the domain home directory"
exe=chk_servers
nam=-
var=ask_servers

[ask_servers]
typ=M
add="*|All servers|*|all_servers"
bef="Oracle WebLogic Server list for '${TMP_DOMAIN_NAME}' Domain:"
dft="${TMP_DFT_SERVERS}"
dsc="Server list for the domain associated to ${TMP_INSTANCE}"
dup="Server already selected"
end="."
err="Enter a menu item number only"
inp="Enter the number corresponding to the server directory name, or * to \
     select all servers, or ${end} to terminate the list"
itm="${TMP_ITM_SERVERS}"
mnu="<<I"
nam=EPM_DOM${CNT.Instance}_WLS_SERVERS
one="*"
rsp="^"
sep="|"
val=E

[all_servers]
typ=T
dft=${TMP_ALL_SERVERS}
dsc="List all servers"
nam=EPM_DOM${CNT.Instance}_WLS_SERVERS

[epm_req_wreq]
typ=B
dft=1
dsc="Does EPM require WebLogic Server Domain Request Handler collection?"
nam=EPM_REQ_WREQ

[set_top_focus]
typ=T
dft="Generic"
dsc="Focus areas for Oracle WebLogic Server middleware collection"
nam=EPM_TOP${CNT.Instance}_FOCUS

[set_dom_focus]
typ=T
dft="ExtDomCfg,ExtSrvCfg,MinDomCfg,MinSrvCfg"
dsc="Focus areas for Oracle WebLogic Server domain collection"
nam=EPM_DOM${CNT.Instance}_FOCUS

#------------------------------------------------------------------------------
# Common settings
#------------------------------------------------------------------------------
[EPM_LOG_AGE]
typ=N
dft=15
dsc="Age limit (in days) of the log files to be collected"
err="The number of days must be a positive number"
inp="Enter the age limit (in days) for the log files to be collected"
lvl=1
ref="R[0,["
val=F

